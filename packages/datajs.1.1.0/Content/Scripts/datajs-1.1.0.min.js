// Copyright (c) Microsoft.  All rights reserved.
// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation
// files (the "Software"), to deal  in the Software without restriction, including without limitation the rights  to use, copy,
// modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the
// Software is furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR  IMPLIED, INCLUDING BUT NOT LIMITED TO THE
// WARRANTIES OF MERCHANTABILITY,  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
// COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
// ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

﻿(function(n,t){var ui=n.datajs||{},r=n.OData||{},so,ho,ii,oy,dy;typeof define=="function"&&define.amd?(define("datajs",ui),define("OData",r)):(n.datajs=ui,n.OData=r);var po=function(t){return n.ActiveXObject?new n.ActiveXObject(t):null},at=function(n){return n!==null&&n!==t},ur=function(n,t){for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return!0;return!1},nt=function(n,i){return n!==t?n:i},o=function(t){if(arguments.length===1){n.setTimeout(t,0);return}var i=Array.prototype.slice.call(arguments,1);n.setTimeout(function(){t.apply(this,i)},0)},tt=function(n,t){for(var i in t)n[i]=t[i];return n},fr=function(n,t){if(n)for(var i=0,r=n.length;i<r;i++)if(t(n[i]))return n[i];return null},e=function(n){return Object.prototype.toString.call(n)==="[object Array]"},hf=function(n){return Object.prototype.toString.call(n)==="[object Date]"},cf=function(n){return typeof n=="object"},s=function(n){return parseInt(n,10)},iu=function(n,t,i){n.hasOwnProperty(t)&&(n[i]=n[t],delete n[t])},ru=function(n){throw n;},wo=function(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")},lf=function(n,i){return n!==t?n:i},gy=/^([^:\/?#]+:)?(\/\/[^\/?#]*)?([^?#:]+)?(\?[^#]*)?(#.*)?/,bo=["scheme","authority","path","query","fragment"],af=function(n){var i={isAbsolute:!1},r,t,u;if(n){if(r=gy.exec(n),r)for(t=0,u=bo.length;t<u;t++)r[t+1]&&(i[bo[t]]=r[t+1]);i.scheme&&(i.isAbsolute=!0)}return i},ko=function(n){return"".concat(n.scheme||"",n.authority||"",n.path||"",n.query||"",n.fragment||"")},np=/^\/{0,2}(?:([^@]*)@)?([^:]+)(?::{1}(\d+))?/,tp=/%[0-9A-F]{2}/ig,ip=function(n){var i=af(n),r=i.scheme,u=i.authority,t;return r&&(i.scheme=r.toLowerCase(),u&&(t=np.exec(u),t&&(i.authority="//"+(t[1]?t[1]+"@":"")+t[2].toLowerCase()+(t[3]?":"+t[3]:"")))),n=ko(i),n.replace(tp,function(n){return n.toLowerCase()})},h=function(n,t){var i,u,r,f;return t?(i=af(n),i.isAbsolute)?n:(u=af(t),r={},i.authority?(r.authority=i.authority,f=i.path,r.query=i.query):(i.path?(f=i.path.charAt(0)==="/"?i.path:rp(i.path,u.path),r.query=i.query):(f=u.path,r.query=i.query||u.query),r.authority=u.authority),r.path=up(f),r.scheme=u.scheme,r.fragment=i.fragment,ko(r)):n},rp=function(n,t){var i="/",r;return t&&(r=t.lastIndexOf("/"),i=t.substring(0,r),i.charAt(i.length-1)!=="/"&&(i=i+"/")),i+n},up=function(n){for(var t="",r="",i;n;)n.indexOf("..")===0||n.indexOf(".")===0?n=n.replace(/^\.\.?\/?/g,""):n.indexOf("/..")===0?(n=n.replace(/^\/\..\/?/g,"/"),i=t.lastIndexOf("/"),t=i===-1?"":t.substring(0,i)):n.indexOf("/.")===0?n=n.replace(/^\/\.\/?/g,"/"):(r=n,i=n.indexOf("/",1),i!==-1&&(r=n.substring(0,i)),t=t+r,n=n.replace(r,""));return t},uu="http://",er=uu+"www.w3.org/",go=er+"1999/xhtml",or=er+"2000/xmlns/",li=er+"XML/1998/namespace",ns=uu+"www.mozilla.org/newlayout/xml/parsererror.xml",fp=function(n){var t=/(^\s)|(\s$)/;return t.test(n)},ep=function(n){var t=/^\s*$/;return n===null||t.test(n)},op=function(n){while(n!==null&&n.nodeType===1){var t=et(n,"space",li);if(t==="preserve")return!0;if(t==="default")break;else n=n.parentNode}return!1},sp=function(n){var t=n.nodeName;return t=="xmlns"||t.indexOf("xmlns:")==0},fu=function(n,t,i){try{n.setProperty(t,i)}catch(r){}},hp=function(){var n=po("Msxml2.DOMDocument.3.0");return n&&(fu(n,"ProhibitDTD",!0),fu(n,"MaxElementDepth",256),fu(n,"AllowDocumentFunction",!1),fu(n,"AllowXsltScript",!1)),n},ts=function(){try{var n=po("Msxml2.DOMDocument.6.0");return n&&(n.async=!0),n}catch(t){return hp()}},cp=function(n){var t=ts(),i;return t?(t.loadXML(n),i=t.parseError,i.errorCode!==0&&sr(i.reason,i.srcText,n),t):null},sr=function(n,t,i){typeof n=="string"&&(n={message:n});throw tt(n,{srcText:t||"",errorXmlText:i||""});},eu=function(t){var s=n.DOMParser&&new n.DOMParser,r,e,l;if(!s)return r=cp(t),r||sr("XML DOM parser not supported"),r;try{r=s.parseFromString(t,"text/xml")}catch(v){sr(v,"",t)}var i=r.documentElement,h=i.namespaceURI,c=f(i);if(c==="parsererror"&&h===ns&&(e=w(i,ns,"sourcetext"),l=e?yi(e):"",sr(b(i)||"",l,t)),c==="h3"&&h===go||vp(i,go,"h3")){for(var o="",a=[],u=i.firstChild;u;)u.nodeType===1&&(o+=b(u)||""),a.push(u.nextSibling),u=u.firstChild||a.shift();o+=b(i)||"",sr(o,"",t)}return r},vt=function(n,t){return n?n+":"+t:t},lp=function(n,t){if(fp(t.data)){var i=vi(n,li,"space");i||(i=fi(n.ownerDocument,li,vt("xml","space")),c(n,i)),i.value="preserve"}return n.appendChild(t),n},ai=function(n,t){for(var r=n.attributes,i=0,u=r.length;i<u;i++)t(r.item(i))},et=function(n,t,i){var r=vi(n,t,i);return r?yi(r):null},vi=function(n,t,i){var r=n.attributes;return r.getNamedItemNS?r.getNamedItemNS(i||null,t):r.getQualifiedItem(t,i)||null},it=function(n,t){var i=vi(n,"base",li);return(i?h(i.value,t):t)||null},y=function(n,t){vf(n,!1,function(n){return n.nodeType===1&&t(n),!0})},is=function(n,t,i){for(var u=i.split("/"),r=0,f=u.length;r<f;r++)n=n&&w(n,t,u[r]);return n||null},ap=function(n,t,i){var f=i.lastIndexOf("/"),r=i.substring(f+1),e=i.substring(0,f),u=e?is(n,t,e):n;return u?r.charAt(0)==="@"?vi(u,r.substring(1),t):w(u,t,r):null},w=function(n,t,i){return rs(n,t,i,!1)},vp=function(n,t,i){if(n.getElementsByTagNameNS){var r=n.getElementsByTagNameNS(t,i);return r.length>0?r[0]:null}return rs(n,t,i,!0)},rs=function(n,t,i,r){var e=null;return vf(n,r,function(n){if(n.nodeType===1){var r=!t||u(n)===t,o=!i||f(n)===i;r&&o&&(e=n)}return e===null}),e},b=function(n){var i=null,r=n.nodeType===9&&n.documentElement?n.documentElement:n,f=r.ownerDocument.preserveWhiteSpace===!1,u;return vf(r,!1,function(n){if(n.nodeType===3||n.nodeType===4){var e=yi(n),o=f||!ep(e);o||(u===t&&(u=op(r)),o=u),o&&(i?i+=e:i=e)}return!0}),i},f=function(n){return n.localName||n.baseName},u=function(n){return n.namespaceURI||null},yi=function(n){return n.nodeType===1?b(n):n.nodeValue},vf=function(n,t,i){for(var f=[],r=n.firstChild,u=!0;r&&u;)u=i(r),u&&(t&&r.firstChild&&f.push(r.firstChild),r=r.nextSibling||f.shift())},yp=function(n,t,i){for(var r=n.nextSibling,e,o;r;){if(r.nodeType===1&&(e=!t||u(r)===t,o=!i||f(r)===i,e&&o))return r;r=r.nextSibling}return null},us=function(){var t=n.document.implementation;return t&&t.createDocument?t.createDocument(null,null,null):ts()},ou=function(n,t){if(!e(t))return c(n,t);for(var i=0,r=t.length;i<r;i++)t[i]&&c(n,t[i]);return n},c=function(n,t){if(t){if(typeof t=="string")return lp(n,wp(n.ownerDocument,t));t.nodeType===2?n.setAttributeNodeNS?n.setAttributeNodeNS(t):n.setAttributeNode(t):n.appendChild(t)}return n},fi=function(n,i,r,u){var f=n.createAttributeNS&&n.createAttributeNS(i,r)||n.createNode(2,r,i||t);return f.value=u||"",f},hr=function(n,i,r,u){var f=n.createElementNS&&n.createElementNS(i,r)||n.createNode(1,r,i||t);return ou(f,u||[])},fs=function(n,t,i){return fi(n,or,vt("xmlns",i),t)},pp=function(n,t){for(var f="<c>"+t+"<\/c>",e=eu(f),r=e.documentElement,o=("importNode"in n)?n.importNode(r,!0):r,u=n.createDocumentFragment(),i=o.firstChild;i;)u.appendChild(i),i=i.nextSibling;return u},wp=function(n,t){return n.createTextNode(t)},bp=function(n,t,i,r,u){for(var f="",h=u.split("/"),l=w,a=hr,o=t,e,s=0,v=h.length;s<v;s++)f=h[s],f.charAt(0)==="@"&&(f=f.substring(1),l=vi,a=fi),e=l(o,i,f),e||(e=a(n,i,vt(r,f)),c(o,e)),o=e;return o},yf=function(t){var i=n.XMLSerializer,r;if(i)return r=new i,r.serializeToString(t);if(t.xml)return t.xml;throw{message:"XML serialization unsupported"};},kp=function(n){var f=n.childNodes,t,r=f.length,i;if(r===0)return"";var e=n.ownerDocument,o=e.createDocumentFragment(),u=e.createElement("c");for(o.appendChild(u),t=0;t<r;t++)u.appendChild(f[t]);for(i=yf(o),i=i.substr(3,i.length-7),t=0;t<r;t++)n.appendChild(u.childNodes[t]);return i},iit=function(i){var r=i.xml,u;if(r!==t)return r;if(n.XMLSerializer)return u=new n.XMLSerializer,u.serializeToString(i);throw{message:"XML serialization unsupported"};},dp=function(n,t,i){return function(){return n[t].apply(n,arguments),i}},pi=function(){this._arguments=t,this._done=t,this._fail=t,this._resolved=!1,this._rejected=!1};pi.prototype={then:function(n,t){return n&&(this._done?this._done.push(n):this._done=[n]),t&&(this._fail?this._fail.push(t):this._fail=[t]),this._resolved?this.resolve.apply(this,this._arguments):this._rejected&&this.reject.apply(this,this._arguments),this},resolve:function(){if(this._done){for(var n=0,i=this._done.length;n<i;n++)this._done[n].apply(null,arguments);this._done=t,this._resolved=!1,this._arguments=t}else this._resolved=!0,this._arguments=arguments},reject:function(){if(this._fail){for(var n=0,i=this._fail.length;n<i;n++)this._fail[n].apply(null,arguments);this._fail=t,this._rejected=!1,this._arguments=t}else this._rejected=!0,this._arguments=arguments},promise:function(){var n={};return n.then=dp(this,"then",n),n}};var su=function(){return n.jQuery&&n.jQuery.Deferred?new n.jQuery.Deferred:new pi},es=function(n,t){var i=(n&&n.__metadata||{}).type;return i||(t?t.type:null)},a="Edm.",os=a+"Binary",ss=a+"Boolean",hs=a+"Byte",hu=a+"DateTime",cu=a+"DateTimeOffset",cs=a+"Decimal",ls=a+"Double",as=a+"Guid",vs=a+"Int16",ys=a+"Int32",ps=a+"Int64",ws=a+"SByte",bs=a+"Single",cr=a+"String",lu=a+"Time",ot=a+"Geography",ks=ot+"Point",ds=ot+"LineString",gs=ot+"Polygon",nh=ot+"Collection",th=ot+"MultiPolygon",ih=ot+"MultiLineString",rh=ot+"MultiPoint",ft=a+"Geometry",uh=ft+"Point",fh=ft+"LineString",eh=ft+"Polygon",oh=ft+"Collection",sh=ft+"MultiPolygon",hh=ft+"MultiLineString",ch=ft+"MultiPoint",pf="Point",wf="LineString",bf="Polygon",kf="MultiPoint",df="MultiLineString",gf="MultiPolygon",ne="GeometryCollection",gp=[cr,ys,ps,ss,ls,bs,hu,cu,lu,cs,as,hs,vs,ws,os],nw=[ft,uh,fh,eh,oh,sh,hh,ch],tw=[ot,ks,ds,gs,nh,th,ih,rh],lr=function(n,t){if(!n)return null;if(e(n)){for(var r,i=0,u=n.length;i<u;i++)if(r=lr(n[i],t),r)return r;return null}return n.dataServices?lr(n.dataServices.schema,t):t(n)},lh=function(n,t){return n=n===0?"":"."+l(n.toString(),3),t>0&&(n===""&&(n=".000"),n+=l(t.toString(),4)),n},ah=function(n){var u,t,e;if(typeof n=="string")return n;if(u=fw(n),t=yh(n.__offset),u&&t!=="Z"){n=new Date(n.valueOf());var i=uc(t),o=n.getUTCHours()+i.d*i.h,s=n.getMinutes()+i.d*i.m;n.setUTCHours(o,s)}else u||(t="");var r=n.getUTCFullYear(),h=n.getUTCMonth()+1,f="";return r<=0&&(r=-(r-1),f="-"),e=lh(n.getUTCMilliseconds(),n.__ns),f+l(r,4)+"-"+l(h,2)+"-"+l(n.getUTCDate(),2)+"T"+l(n.getUTCHours(),2)+":"+l(n.getUTCMinutes(),2)+":"+l(n.getUTCSeconds(),2)+e+t},vh=function(n){var t=n.ms,e="",i,r,u,f;return t<0&&(e="-",t=-t),i=Math.floor(t/864e5),t-=864e5*i,r=Math.floor(t/36e5),t-=36e5*r,u=Math.floor(t/6e4),t-=6e4*u,f=Math.floor(t/1e3),t-=f*1e3,e+"P"+l(i,2)+"DT"+l(r,2)+"H"+l(u,2)+"M"+l(f,2)+lh(t,n.ns)+"S"},l=function(n,t,i){for(var r=n.toString(10);r.length<t;)i?r+="0":r="0"+r;return r},yh=function(n){return!n||n==="Z"||n==="+00:00"||n==="-00:00"?"Z":n},au=function(n){if(typeof n=="string"){var t=n.indexOf(")",10);if(n.indexOf("Collection(")===0&&t>0)return n.substring(11,t)}return null},iw=function(n,i,r,u,f,e){return f.request(n,function(f){try{f.headers&&fe(f.headers),f.data===t&&f.statusCode!==204&&u.read(f,e)}catch(o){o.request===t&&(o.request=n),o.response===t&&(o.response=f),r(o);return}i(f.data,f)},r)},rw=function(n){return k(n)&&e(n.__batchRequests)},uw=/Collection\((.*)\)/,ph=function(n,t){var i=n&&n.results||n;return!!i&&vu(t)||!t&&e(i)&&!k(i[0])},vu=function(n){return uw.test(n)},k=function(n){return!!n&&cf(n)&&!e(n)&&!hf(n)},fw=function(n){return n.__edmType==="Edm.DateTimeOffset"||!n.__edmType&&n.__offset},wh=function(n){if(!n&&!k(n))return!1;var t=n.__metadata||{},i=n.__deferred||{};return!t.type&&!!i.uri},bh=function(n){return k(n)&&n.__metadata&&"uri"in n.__metadata},ar=function(n,t){var i=n&&n.results||n;return e(i)&&!vu(t)&&k(i[0])},te=function(n){return ur(tw,n)},ie=function(n){return ur(nw,n)},kh=function(n){if(!n&&!k(n))return!1;var i=n.__metadata,t=n.__mediaresource;return!i&&!!t&&!!t.media_src},yu=function(n){return hf(n)||typeof n=="string"||typeof n=="number"||typeof n=="boolean"},re=function(n){return ur(gp,n)},dh=function(n,i){return wh(n)?"deferred":bh(n)?"entry":ar(n)?"feed":i&&i.relationship?n===null||n===t||!ar(n)?"entry":"feed":null},wi=function(n,t){return fr(n,function(n){return n.name===t})},ue=function(n,t,i){return n?lr(t,function(t){return hw(n,t,i)}):null},ew=function(n,t){return fr(n,function(n){return n.name===t})},bi=function(n,t){return ue(n,t,"complexType")},ki=function(n,t){return ue(n,t,"entityType")},gh=function(n){return lr(n,function(n){return fr(n.entityContainer,function(n){return ee(n.isDefaultEntityContainer)})})},nc=function(n,t){return ue(n,t,"entityContainer")},ow=function(n,t){return fr(n,function(n){return n.name===t})},sw=function(n,t){var u=null,f,i,r;return n&&(f=n.relationship,i=lr(t,function(n){var r=tc(n.namespace,f),i=n.association,t,u;if(r&&i)for(t=0,u=i.length;t<u;t++)if(i[t].name===r)return i[t]}),i&&(r=i.end[0],r.role!==n.toRole&&(r=i.end[1]),u=r.type)),u},tc=function(n,t){return t.indexOf(n)===0&&t.charAt(n.length)==="."?t.substr(n.length+1):null},hw=function(n,t,i){if(n&&t){var r=tc(t.namespace,n);if(r)return fr(t[i],function(n){return n.name===r})}return null},st=function(n,t){var i,f,e;if(n===t)return n;var r=n.split("."),u=t.split("."),o=r.length>=u.length?r.length:u.length;for(i=0;i<o;i++){if(f=r[i]&&s(r[i]),e=u[i]&&s(u[i]),f>e)return n;if(f<e)return t}},cw={accept:"Accept","content-type":"Content-Type",dataserviceversion:"DataServiceVersion",maxdataserviceversion:"MaxDataServiceVersion"},fe=function(n){var t,r,i,u;for(t in n)r=t.toLowerCase(),i=cw[r],i&&t!==i&&(u=n[t],delete n[t],n[i]=u)},ee=function(n){return typeof n=="boolean"?n:typeof n=="string"&&n.toLowerCase()==="true"},lw=/^(-?\d{4,})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(.*)$/,ic=function(n,t,i){var r=lw.exec(n),o=r?yh(r[8]):null,h,u,e,c,a,f;if(!r||!t&&o!=="Z"){if(i)return null;throw{message:"Invalid date/time value"};}if(h=s(r[1]),h<=0&&h++,u=r[7],e=0,u){if(u.length>7){if(i)return null;throw{message:"Cannot parse date/time value to given precision."};}e=l(u.substring(3),4,!0),u=l(u.substring(0,3),3,!0),u=s(u),e=s(e)}else u=0;var v=s(r[4]),y=s(r[5]),p=s(r[6]);if(o!=="Z"&&(c=uc(o),a=-c.d,v+=c.h*a,y+=c.m*a),f=new Date,f.setUTCFullYear(h,s(r[2])-1,s(r[3])),f.setUTCHours(v,y,p,u),isNaN(f.valueOf())){if(i)return null;throw{message:"Invalid date/time value"};}return t&&(f.__edmType="Edm.DateTimeOffset",f.__offset=o),e&&(f.__ns=e),f},pu=function(n,t){return ic(n,!1,t)},oe=function(n,t){return ic(n,!0,t)},rc=/^([+-])?P(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)(?:\.(\d+))?S)?)?/,rit=function(n){rc.test(n)},se=function(n){var i=rc.exec(n),t,r,u;if(i===null)throw{message:"Invalid duration value."};var f=i[2]||"0",e=i[3]||"0",o=s(i[4]||0),h=s(i[5]||0),c=s(i[6]||0),a=parseFloat(i[7]||0);if(f!=="0"||e!=="0")throw{message:"Unsupported duration value."};if(t=i[8],r=0,t){if(t.length>7)throw{message:"Cannot parse duration value to given precision."};r=l(t.substring(3),4,!0),t=l(t.substring(0,3),3,!0),t=s(t),r=s(r)}else t=0;return t+=a*1e3+c*6e4+h*36e5+o*864e5,i[1]==="-"&&(t=-t),u={ms:t,__edmType:"Edm.Time"},r&&(u.ns=r),u},uc=function(n){var t=n.substring(0,1),i,r;return t=t==="+"?1:-1,i=s(n.substring(1)),r=s(n.substring(n.indexOf(":")+1)),{d:t,h:i,m:r}},fc=function(n,i,r){n.method||(n.method="GET"),n.headers?fe(n.headers):n.headers={},n.headers.Accept===t&&(n.headers.Accept=i.accept),at(n.data)&&n.body===t&&i.write(n,r),at(n.headers.MaxDataServiceVersion)||(n.headers.MaxDataServiceVersion=i.maxDataServiceVersion||"1.0")},ec=function(n,i,r){var u,e,f;if(n&&typeof n=="object")for(u in n)e=n[u],f=ec(e,u,r),f=r(u,f,i),f!==e&&(e===t?delete n[u]:n[u]=f);return n},aw=function(n,t){return t("",ec(n,"",t))},wu=0,vw=function(n){return n.method&&n.method!=="GET"?!1:!0},yw=function(t){var i=n.document.createElement("IFRAME");i.style.display="none";var r=t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\</g,"&lt;"),u='<html><head><script type="text/javascript" src="'+r+'"><\/script><\/head><body><\/body><\/html>',f=n.document.getElementsByTagName("BODY")[0];return f.appendChild(i),oc(i,u),i},pw=function(){if(n.XMLHttpRequest)return new n.XMLHttpRequest;var t;if(n.ActiveXObject)try{return new n.ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(i){try{return new n.ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(r){t=r}}else t={message:"XMLHttpRequest not supported"};throw t;},ww=function(n){return n.indexOf("http://")===0||n.indexOf("https://")===0||n.indexOf("file://")===0},bw=function(t){if(!ww(t))return!0;var i=n.location,r=i.protocol+"//"+i.host+"/";return t.indexOf(r)===0},kw=function(i,r){try{delete n[i]}catch(u){n[i]=t,r===wu-1&&(wu-=1)}},he=function(n){return n&&(oc(n,""),n.parentNode.removeChild(n)),null},dw=function(n,t){for(var r=n.getAllResponseHeaders().split(/\r?\n/),u,i=0,f=r.length;i<f;i++)r[i]&&(u=r[i].split(": "),t[u[0]]=u[1])},oc=function(n,t){var i=n.contentWindow?n.contentWindow.document:n.contentDocument.document;i.open(),i.write(t),i.close()};r.defaultHttpClient={callbackParameterName:"$callback",formatQueryString:"$format=json",enableJsonpCallback:!1,request:function(t,i,r){var v={},u=null,e=!1,s,l,p,w,b,k,c,a;v.abort=function(){(s=he(s),e)||(e=!0,u&&(u.abort(),u=null),r({message:"Request aborted"}))};var y=function(){s=he(s),e||(e=!0,u=null,r({message:"Request timed out"}))},h,f=t.requestUri,d=nt(t.enableJsonpCallback,this.enableJsonpCallback),g=nt(t.callbackParameterName,this.callbackParameterName),tt=nt(t.formatQueryString,this.formatQueryString);if(!d||bw(f)){if(u=pw(),u.onreadystatechange=function(){var o,n,s,h;e||u===null||u.readyState!==4||(o=u.statusText,n=u.status,n===1223&&(n=204,o="No Content"),s=[],dw(u,s),h={requestUri:f,statusCode:n,statusText:o,headers:s,body:u.responseText},e=!0,u=null,n>=200&&n<=299?i(h):r({message:"HTTP request failed",request:t,response:h}))},u.open(t.method||"GET",f,!0,t.user,t.password),t.headers)for(h in t.headers)u.setRequestHeader(h,t.headers[h]);t.timeoutMS&&(u.timeout=t.timeoutMS,u.ontimeout=y),u.send(t.body)}else{if(!vw(t))throw{message:"Request is not local and cannot be done through JSONP."};l=wu,wu+=1,p=l.toString(),w=!1,h="handleJSONP_"+p,n[h]=function(t){s=he(s),e||(w=!0,n.clearTimeout(b),kw(h,l),n.ActiveXObject&&!n.DOMParser&&(t=n.JSON.parse(n.JSON.stringify(t))),o(i,{body:t,statusCode:200,headers:{"Content-Type":"application/json"}}))},k=t.timeoutMS?t.timeoutMS:12e4,b=n.setTimeout(y,k),c=g+"=parent."+h,this.formatQueryString&&(c+="&"+tt),a=f.indexOf("?"),f=a===-1?f+"?"+c:a===f.length-1?f+c:f+"&"+c,s=yw(f)}return v}};var ei="3.0",di=function(n){var t,r,i,f,u;if(!n)return null;for(t=n.split(";"),r={},i=1,f=t.length;i<f;i++)u=t[i].split("="),r[wo(u[0])]=u[1];return{mediaType:wo(t[0]),properties:r}},gw=function(n){if(!n)return t;var r=n.mediaType,i;for(i in n.properties)r+=";"+i+"="+n.properties[i];return r},sc=function(n,t,i,r){var u={contentType:n,dataServiceVersion:t,handler:r};return tt(u,i)},hc=function(n,t,i){if(n){var r=n.headers;r[t]||(r[t]=i)}},nb=function(n,t){if(n){var i=n.headers,r=i.DataServiceVersion;i.DataServiceVersion=r?st(r,t):t}},cc=function(n,i){var r=n.headers;return r&&r[i]||t},lc=function(n){return di(cc(n,"Content-Type"))},tb=/^\s?(\d+\.\d+);?.*$/,ac=function(n){var i=cc(n,"DataServiceVersion"),t;if(i&&(t=tb.exec(i),t&&t.length))return t[1]},vc=function(n,t){return n.accept.indexOf(t.mediaType)>=0},ib=function(n,i,r,u){var f;if(!r||!r.headers)return!1;var e=lc(r),s=ac(r)||"",o=r.body;return at(o)?vc(n,e)?(f=sc(e,s,u,n),f.response=r,r.data=i(n,o,f),r.data!==t):!1:!1},rb=function(n,i,r,u){var e,o,f;return!r||!r.headers?!1:(e=lc(r),o=ac(r),(!e||vc(n,e))&&(f=sc(e,o,u,n),f.request=r,r.body=i(n,r.data,f),r.body!==t))?(nb(r,f.dataServiceVersion||"1.0"),hc(r,"Content-Type",gw(f.contentType)),hc(r,"MaxDataServiceVersion",n.maxDataServiceVersion),!0):!1},oi=function(n,t,i,r){return{accept:i,maxDataServiceVersion:r,read:function(t,i){return ib(this,n,t,i)},write:function(n,i){return rb(this,t,n,i)}}},ub=function(n,t){return t},fb=function(n,i){return at(i)?i.toString():t};r.textHandler=oi(ub,fb,"text/plain",ei);var yc=uu+"www.opengis.net",rt=yc+"/gml",pc=yc+"/def/crs/EPSG/0/",wc="gml",vr=function(n,t,i){var r={type:n};return r[t]=i,r},ce=function(n){if(e(n)&&n.length>=2){var t=n[0];n[0]=n[1],n[1]=t}return n},le=function(n,t,i,r,u,f){var e=bc(n,i,r,u,f);return vr(t,"coordinates",e)},bc=function(n,t,i,r,e){var o=[];return y(n,function(n){var s,h,c;if(u(n)===rt){if(s=f(n),s===t){h=w(n,rt),h&&(c=r(h,e),c&&o.push(c));return}s===i&&y(n,function(n){if(u(n)===rt){var t=r(n,e);t&&o.push(t)}})}}),o},eb=function(n,t){var i=bc(n,"geometryMember","geometryMembers",gc,t);return vr(ne,"geometries",i)},ob=function(n,t){return vr(wf,"coordinates",ae(n,t))},sb=function(n,t){return le(n,df,"curveMember","curveMembers",ae,t)},hb=function(n,t){return le(n,kf,"pointMember","pointMembers",ve,t)},cb=function(n,t){return le(n,gf,"surfaceMember","surfaceMembers",kc,t)},lb=function(n,t){return vr(pf,"coordinates",ve(n,t))},ab=function(n,t){return vr(bf,"coordinates",kc(n,t))},ae=function(n,t){var i=[];return y(n,function(n){var e=u(n),r;if(e===rt){if(r=f(n),r==="posList"){i=yb(n,t);return}if(r==="pointProperty"){i.push(vb(n,t));return}if(r==="pos"){i.push(ye(n,t));return}}}),i},ve=function(n,t){var i=w(n,rt,"pos");return i?ye(i,t):[]},vb=function(n,t){var i=w(n,rt,"Point");return i?ve(i,t):[]},kc=function(n,t){var i=[],r=!1;return y(n,function(n){if(u(n)===rt){var e=f(n);if(e==="exterior"){r=!0,i.unshift(dc(n,t));return}if(e==="interior"){i.push(dc(n,t));return}}}),!r&&i.length>0&&i.unshift([[]]),i},dc=function(n,t){var i=[];return y(n,function(n){u(n)===rt&&f(n)==="LinearRing"&&(i=ae(n,t))}),i},yb=function(n,t){var f=ye(n,!1),e=f.length,r,i,u;if(e%2!=0)throw{message:"GML posList element has an uneven number of numeric values"};for(r=[],i=0;i<e;i+=2)u=f.slice(i,i+2),r.push(t?ce(u):u);return r},ye=function(n,t){var u=[],o=" \t\r\n",r=b(n),f;if(r)for(var s=r.length,e=0,i=0;i<=s;)o.indexOf(r.charAt(i))!==-1&&(f=r.substring(e,i),f&&u.push(parseFloat(f)),e=i+1),i++;return t?ce(u):u},gc=function(n,t){var o=f(n),i,u,r,e;switch(o){case"Point":i=lb;break;case"Polygon":i=ab;break;case"LineString":i=ob;break;case"MultiPoint":i=hb;break;case"MultiCurve":i=sb;break;case"MultiSurface":i=cb;break;case"MultiGeometry":i=eb;break;default:throw{message:"Unsupported element: "+o,element:n};}if(u=i(n,t),r=et(n,"srsName",rt)||et(n,"srsName"),r){if(r.indexOf(pc)!==0)throw{message:"Unsupported srs name: "+r,element:n};e=r.substring(pc.length),e&&(u.crs={type:"name",properties:{name:"EPSG:"+e}})}return u},nl=function(n,t,i,r){var u,o,e,s,f,h,l;switch(i){case pf:u=pb;break;case wf:u=wb;break;case bf:u=bb;break;case kf:u=kb;break;case df:u=db;break;case gf:u=gb;break;case ne:u=tk;break;default:return null}return o=u(n,t,r),e=t.crs,e&&e.type==="name"&&(s=e.properties,f=s&&s.name,f&&f.indexOf("ESPG:")===0&&f.length>5&&(h=f.substring(5),l=fi(n,null,"srsName",wc+h),c(o,l))),o},yt=function(n,t,i){return hr(n,rt,vt(wc,t),i)},tl=function(n,t,i){var r=e(t)?t:[];return r=i?ce(r):r,yt(n,"pos",r.join(" "))},il=function(n,t,i,r){var f=yt(n,t),u,o;if(e(i)){for(u=0,o=i.length;u<o;u++)c(f,tl(n,i[u],r));o===0&&c(f,yt(n,"posList"))}return f},rl=function(n,t,i){return yt(n,"Point",tl(n,t,i))},ul=function(n,t,i){return il(n,"LineString",t,i)},fl=function(n,t,i,r){var u=yt(n,t),f;return e(i)&&i.length>0&&(f=il(n,"LinearRing",i,r),c(u,f)),u},el=function(n,t,i){var f=t&&t.length,u=yt(n,"Polygon"),r;if(e(t)&&f>0)for(c(u,fl(n,"exterior",t[0],i)),r=1;r<f;r++)c(u,fl(n,"interior",t[r],i));return u},pb=function(n,t,i){return rl(n,t.coordinates,i)},wb=function(n,t,i){return ul(n,t.coordinates,i)},bb=function(n,t,i){return el(n,t.coordinates,i)},bu=function(n,t,i,r,u,f){var h=r&&r.length,l=yt(n,t),s,o;if(e(r)&&h>0){for(s=yt(n,i),o=0;o<h;o++)c(s,u(n,r[o],f));c(l,s)}return l},kb=function(n,t,i){return bu(n,"MultiPoint","pointMembers",t.coordinates,rl,i)},db=function(n,t,i){return bu(n,"MultiCurve","curveMembers",t.coordinates,ul,i)},gb=function(n,t,i){return bu(n,"MultiSurface","surfaceMembers",t.coordinates,el,i)},nk=function(n,t,i){return nl(n,t,t.type,i)},tk=function(n,t,i){return bu(n,"MultiGeometry","geometryMembers",t.geometries,nk,i)},ku="application/xml",pt=uu+"schemas.microsoft.com/ado/",si=pt+"2007/08/dataservices",du=pt+"2007/06/edmx",ik=pt+"2006/04/edm",rk=pt+"2007/05/edm",uk=pt+"2008/01/edm",fk=pt+"2008/09/edm",ek=pt+"2009/08/edm",ok=pt+"2009/11/edm",ht=si,d=si+"/metadata",pe=si+"/related/",ol=si+"/scheme",sl="d",we="m",wt=function(n,t){var i={name:f(n),value:n.value};return i[t?"namespaceURI":"namespace"]=u(n),i},yr=function(n,t){for(var s=[],h=[],c=n.attributes,e,i,o,r=0,l=c.length;r<l;r++)e=c[r],u(e)!==or&&s.push(wt(e,t));for(i=n.firstChild;i!=null;)i.nodeType===1&&h.push(yr(i,t)),i=i.nextSibling;return o={name:f(n),value:b(n),attributes:s,children:h},o[t?"namespaceURI":"namespace"]=u(n),o},be=function(n){return u(n)===ht&&f(n)==="element"},hl=function(n,t){return{type:n,extensions:t}},sk=function(n){var t,i;return w(n,rt)?ft:(t=w(n,ht),!t)?cr:be(t)&&(i=yp(t,ht),i&&be(i))?"Collection()":null},cl=function(n){var t=null,i=!1,r=[];return ai(n,function(n){var e=u(n),o=f(n),s=yi(n);if(e===d){if(o==="null"){i=s.toLowerCase()==="true";return}if(o==="type"){t=s;return}}if(e!==li&&e!==or){r.push(wt(n,!0));return}}),{type:!t&&i?cr:t,isNull:i,extensions:r}},ll=function(n){if(u(n)!==ht)return null;var e=f(n),t=cl(n),o=t.isNull,i=t.type,r=hl(i,t.extensions),s=o?null:al(n,i,r);return{name:e,value:s,metadata:r}},al=function(n,t,i){t||(t=sk(n),i.type=t);var r=te(t);return r||ie(t)?hk(n,t,r):re(t)?vl(n,t):vu(t)?lk(n,t,i):ck(n,t,i)},hk=function(n,t,i){var u=w(n,rt),r=gc(u,i);return r.__metadata={type:t},r},vl=function(n,t){var i=yi(n)||"";switch(t){case ss:return ee(i);case os:case cs:case as:case ps:case cr:return i;case hs:case vs:case ys:case ws:return s(i);case ls:case bs:return parseFloat(i);case lu:return se(i);case hu:return pu(i);case cu:return oe(i)}return i},ck=function(n,t,i){var r={__metadata:{type:t}};return y(n,function(n){var t=ll(n),u=t.name;i.properties=i.properties||{},i.properties[u]=t.metadata,r[u]=t.value}),r},lk=function(n,t,i){var r=[],u=i.elements=[],f=au(t);return y(n,function(n){if(be(n)){var t=cl(n),o=t.extensions,i=t.type||f,e=hl(i,o),s=al(n,i,e);r.push(s),u.push(e)}}),{__metadata:{type:t==="Collection()"?null:t},results:r}},ak=function(n,i){if(u(n)===ht){i=it(n,i);var r=f(n);if(r==="links")return vk(n,i);if(r==="uri")return yl(n,i)}return t},vk=function(n,t){var i=[];return y(n,function(n){f(n)==="uri"&&u(n)===ht&&i.push(yl(n,t))}),{results:i}},yl=function(n,t){var i=b(n)||"";return{uri:h(i,t)}},yk=function(n,t){return t===ft||t===ot?n&&n.type:t===uh||t===ks?pf:t===fh||t===ds?wf:t===eh||t===gs?bf:t===oh||t===nh?ne:t===sh||t===th?gf:t===hh||t===ih?df:t===ch||t===rh?kf:null},pl=function(n,t,i){return hr(n,d,vt(we,t),i)},ke=function(n,t,i){return fi(n,d,vt(we,t),i)},wl=function(n,t,i){return hr(n,ht,vt(sl,t),i)},pk=function(n,t){return t===hu||t===cu||hf(n)?ah(n):t===lu?vh(n):n.toString()},ct=function(n,t){return{element:n,dsv:t}},pr=function(n,t,i,r){var u=i?ke(n,"type",i):null,f=wl(n,t,u);return ou(f,r)},wk=function(n,t,i,r){var u=pk(i,r),f=pr(n,t,r,u);return ct(f,"1.0")},bk=function(n,t,i,r){var u=ke(n,"null","true"),f=pr(n,t,i,u),e=bi(i,r)?"2.0":"1.0";return ct(f,e)},kk=function(n,t,i,r,u,f,o){var l=au(r),a=e(i)?i:i.results,v=r?{type:l}:{},h,s,y,p,w;for(v.properties=u.properties,h=pr(n,t,l?r:null),s=0,y=a.length;s<y;s++)p=a[s],w=de(n,"element",p,v,f,o),c(h,w.element);return ct(h,"3.0")},dk=function(n,t,i,r,u,f,e){var h=pr(n,t,r),a=u.properties||{},v=bi(r,e)||{},s="1.0",o;for(o in i)if(o!=="__metadata"){var y=i[o],p=wi(v.property,o),w=a[o]||{},l=de(n,o,y,w,p,e);s=st(s,l.dsv),c(h,l.element)}return ct(h,s)},gk=function(n,t,i,r,u){var f=yk(i,r),e=nl(n,i,f,u),o=pr(n,t,r,e);return ct(o,"3.0")},de=function(n,t,i,r,u,f){var e=es(i,r,u),o,s;return yu(i)?wk(n,t,i,e||cr):(o=te(e),o||ie(e))?gk(n,t,i,e,o):ph(i,e)?kk(n,t,i,e,r,u,f):kh(i)?null:(s=dh(i,u),s!==null)?null:i===null?bk(n,t,e):dk(n,t,i,e,r,u,f)},nd=function(n){if(n&&cf(n)){var t=us();return c(t,wl(t,"uri",n.uri))}},td=function(n,t){if(t){var r=eu(t),i=w(r);if(i)return ak(i)}},id=function(n,i,r){var u=r.contentType=r.contentType||di(ku);return u&&u.mediaType===ku?yf(nd(i)):t};r.xmlHandler=oi(td,id,ku,ei);var bl="a",bt=er+"2005/Atom",wr=er+"2007/app",kl=si+"/edit-media/",dl=si+"/mediaresource/",gl=si+"/relatedlinks/",na=["application/atom+xml","application/atomsvc+xml","application/xml"],ta=na[0],rd=[bt,wr,li,or],ud={SyndicationAuthorEmail:"author/email",SyndicationAuthorName:"author/name",SyndicationAuthorUri:"author/uri",SyndicationContributorEmail:"contributor/email",SyndicationContributorName:"contributor/name",SyndicationContributorUri:"contributor/uri",SyndicationPublished:"published",SyndicationRights:"rights",SyndicationSummary:"summary",SyndicationTitle:"title",SyndicationUpdated:"updated"},fd=function(n){return ud[n]||n},br=function(n){return!ur(rd,n)},ia=function(n,t,i,r,u){var f;if(u=u||"",f=n["FC_TargetPath"+u],!f)return null;var e=n["FC_SourcePath"+u],s=fd(f),o=r?r+(e?"/"+e:""):e,l=o&&ld(i,t,o),h=n["FC_NsUri"+u]||null,c=n["FC_NsPrefix"+u]||null,a=n["FC_KeepInContent"+u]||"";return f!==s&&(h=bt,c=bl),{contentKind:n["FC_ContentKind"+u],keepInContent:a.toLowerCase()==="true",nsPrefix:c,nsURI:h,propertyPath:o,propertyType:l,entryPath:s}},ra=function(n,t,i){for(var c=[],l,r,f,u,e;n;){for(l=n.FC_SourcePath,r=ia(n,n,t),r&&i(r),f=n.property||[],u=0,e=f.length;u<e;u++)for(var o=f[u],s=0,h="";r=ia(o,n,t,o.name,h);)i(r),s++,h="_"+s;n=ki(n.baseType,t)}return c},gu=function(n){var t=[];return ai(n,function(n){var i=u(n);br(i)&&t.push(wt(n,!0))}),t},ua=function(n){return yr(n,!0)},fa=function(n,t,i){var e=u(n),r=f(n);if(e===wr&&r==="service")return gd(n,t);if(e===bt){if(r==="feed")return ed(n,t,i);if(r==="entry")return ca(n,t,i)}},ea=function(n,t){var r=[],i={extensions:r};return ai(n,function(e){var o=f(e),s=u(e),c=yi(e);if(s===null){if(o==="title"||o==="metadata"){i[o]=c;return}if(o==="target"){i.target=h(c,it(n,t));return}}br(s)&&r.push(wt(e,!0))}),i},oa=function(n,t,i){var r=i.actions=i.actions||[];r.push(ea(n,t))},sa=function(n,t,i){var r=i.functions=i.functions||[];r.push(ea(n,t))},ed=function(n,t,i){var o=gu(n),r={feed_extensions:o},s=[],e={__metadata:r,results:s};return t=it(n,t),y(n,function(n){var l=u(n),c=f(n);if(l===d){if(c==="count"){e.__count=parseInt(b(n));return}if(c==="action"){oa(n,t,r);return}if(c==="function"){sa(n,t,r);return}}if(br(l)){o.push(yr(n));return}if(c==="entry"){s.push(ca(n,t,i));return}if(c==="link"){od(n,e,t);return}if(c==="id"){r.uri=h(b(n),t),r.uri_extensions=gu(n);return}if(c==="title"){r.title=b(n)||"",r.title_extensions=gu(n);return}}),e},od=function(n,t,i){var r=ha(n,i),f=r.href,e=r.rel,o=r.extensions,u=t.__metadata;if(e==="next"){t.__next=f,u.next_extensions=o;return}if(e==="self"){u.self=f,u.self_extensions=o;return}},ha=function(n,t){t=it(n,t);var r=[],i={extensions:r,baseURI:t};if(ai(n,function(n){var s=u(n),e=f(n),o=n.value;if(e==="href"){i.href=h(o,t);return}if(e==="type"||e==="rel"){i[e]=o;return}br(s)&&r.push(wt(n,!0))}),!i.href)throw{error:"href attribute missing on link element",element:n};return i},sd=function(n,i){if(n.indexOf("/")===-1)return i[n];for(var u=n.split("/"),r=0,f=u.length;r<f;r++){if(i===null)return t;if(i=i[u[r]],i===t)return i}return i},hd=function(n,i,r,u){var o,s,f,h,e;if(n.indexOf("/")===-1)i[n]=r,o=n;else{for(s=n.split("/"),f=0,h=s.length-1;f<h;f++){if(e=i[s[f]],e===t)e={},i[s[f]]=e;else if(e===null)return;i=e}o=s[f],i[o]=r}if(u){var c=i.__metadata=i.__metadata||{},l=c.properties=c.properties||{},a=l[o]=l[o]||{};a.type=u}},cd=function(n,t,i){var e=n.propertyPath,r,u,f;n.keepInContent||sd(e,i)===null||(r=ap(t,n.nsURI,n.entryPath),r)&&(u=n.propertyType,f=n.contentKind==="xhtml"?kp(r):vl(r,u||"Edm.String"),hd(e,i,f,u))},ld=function(n,t,i){for(var s=i.split("/"),u,h,f,e,o,r;t;){for(f=t,u=0,h=s.length;u<h;u++){if(e=f.property,!e)break;if(o=wi(e,s[u]),!o)break;if(r=o.type,!r||re(r))return r||null;if(f=bi(r,n),!f)return null}t=ki(t.baseType,n)}return null},ca=function(n,t,i){var r={},e={__metadata:r},o=et(n,"etag",d),s;return o&&(r.etag=o),t=it(n,t),y(n,function(n){var s=u(n),o=f(n);if(s===bt){if(o==="id"){ad(n,r,t);return}if(o==="category"){vd(n,r);return}if(o==="content"){yd(n,e,r,t);return}if(o==="link"){pd(n,e,r,t,i);return}return}if(s===d){if(o==="properties"){va(n,e,r);return}if(o==="action"){oa(n,t,r);return}if(o==="function"){sa(n,t,r);return}}}),s=ki(r.type,i),ra(s,i,function(t){cd(t,n,e)}),e},ad=function(n,t,i){t.uri=h(b(n),it(n,i)),t.uri_extensions=gu(n)},vd=function(n,t){if(et(n,"scheme")===ol){if(t.type)throw{message:"Invalid AtomPub document: multiple category elements defining the entry type were encounterd withing an entry",element:n};var i=[];ai(n,function(n){var t=u(n),r=f(n);if(!t){r!=="scheme"&&r!=="term"&&i.push(wt(n,!0));return}br(t)&&i.push(wt(n,!0))}),t.type=et(n,"term"),t.type_extensions=i}},yd=function(n,t,i,r){var e=et(n,"src"),o=et(n,"type");if(e){if(!o)throw{message:"Invalid AtomPub document: content element must specify the type attribute if the src attribute is also specified",element:n};i.media_src=h(e,it(n,r)),i.content_type=o}y(n,function(r){if(e)throw{message:"Invalid AtomPub document: content element must not have child elements if the src attribute is specified",element:n};u(r)===d&&f(r)==="properties"&&va(r,t,i)})},pd=function(n,t,i,r,u){var f=ha(n,r),e=f.rel,s=f.href,o=f.extensions;if(e==="self"){i.self=s,i.self_link_extensions=o;return}if(e==="edit"){i.edit=s,i.edit_link_extensions=o;return}if(e==="edit-media"){i.edit_media=f.href,i.edit_media_extensions=o,aa(f,i);return}if(e.indexOf(kl)===0){kd(f,t,i);return}if(e.indexOf(dl)===0){dd(f,t,i);return}if(e.indexOf(pe)===0){bd(n,f,t,i,u);return}if(e.indexOf(gl)===0){wd(f,i);return}},wd=function(n,t){var r=n.rel.substring(gl.length),i;t.properties=t.properties||{},i=t.properties[r]=t.properties[r]||{},i.associationuri=n.href,i.associationuri_extensions=n.extensions},bd=function(n,t,i,r,u){var e,o=w(n,d,"inline"),s,h,f,c;o?(s=w(o),h=it(o,t.baseURI),e=s?fa(s,h,u):null):e={__deferred:{uri:t.href}},f=t.rel.substring(pe.length),i[f]=e,r.properties=r.properties||{},c=r.properties[f]=r.properties[f]||{},c.extensions=t.extensions},kd=function(n,t,i){var o=n.rel.substring(kl.length),f=la(o,t,i),r=f.value,u=f.metadata,e=n.href;r.edit_media=e,r.content_type=n.type,u.edit_media_extensions=n.extensions,r.media_src=r.media_src||e,u.media_src_extensions=u.media_src_extensions||[],aa(n,r)},dd=function(n,t,i){var f=n.rel.substring(dl.length),r=la(f,t,i),u=r.value,e=r.metadata;u.media_src=n.href,e.media_src_extensions=n.extensions,u.content_type=n.type},la=function(n,t,i){i.properties=i.properties||{};var u=i.properties[n],r=t[n]&&t[n].__mediaresource;return r||(r={},t[n]={__mediaresource:r},i.properties[n]=u={}),{value:r,metadata:u}},aa=function(n,t){for(var r=n.extensions,i=0,u=r.length;i<u;i++)if(r[i].namespaceURI===d&&r[i].name==="etag"){t.media_etag=r[i].value,r.splice(i,1);return}},va=function(n,t,i){y(n,function(n){var r=ll(n),u,f;r&&(u=r.name,f=i.properties=i.properties||{},f[u]=r.metadata,t[u]=r.value)})},gd=function(n,t){var i=[],r=[];if(t=it(n,t),y(n,function(n){if(u(n)===wr&&f(n)==="workspace"){i.push(ng(n,t));return}r.push(yr(n))}),i.length===0)throw{message:"Invalid AtomPub service document: No workspace element found.",element:n};return{workspaces:i,extensions:r}},ng=function(n,i){var e=[],o=[],r=t;return i=it(n,i),y(n,function(n){var s=u(n),h=f(n);if(s===bt&&h==="title"){if(r!==t)throw{message:"Invalid AtomPub service document: workspace has more than one child title element",element:n};r=b(n);return}if(s===wr){h==="collection"&&e.push(tg(n,i));return}o.push(ua(n))}),{title:r||"",collections:e,extensions:o}},tg=function(n,i){var e=et(n,"href"),o,r;if(!e)throw{message:"Invalid AtomPub service document: collection has no href attribute",element:n};if(i=it(n,i),e=h(e,it(n,i)),o=[],r=t,y(n,function(i){var e=u(i),s=f(i);if(e===bt){if(s==="title"){if(r!==t)throw{message:"Invalid AtomPub service document: collection has more than one child title element",element:i};r=b(i)}return}e!==wr&&o.push(ua(n))}),!r)throw{message:"Invalid AtomPub service document: collection has no title element",element:n};return{title:r,href:e,extensions:o}},kt=function(n,t,i){return hr(n,bt,vt(bl,t),i)},gi=function(n,t,i){return fi(n,null,t,i)},ig=function(n){var t,e,i,o,r;if(n.childNodes.length>0)return!1;for(t=!0,e=n.attributes,i=0,o=e.length;i<o&&t;i++)r=e[i],t=t&&sp(r)||u(r)==d&&f(r)==="type";return t},rg=function(n,t,i,r,u){var s=null,e=null,f=null,o="",l;return i!=="deferred"?(s=gi(n,"type","application/atom+xml;type="+i),e=pl(n,"inline"),r&&(o=r.__metadata&&r.__metadata.uri||"",f=ya(n,r,u)||ge(n,r,u),c(e,f.element))):o=r.__deferred.uri,l=kt(n,"link",[gi(n,"href",o),gi(n,"rel",h(t,pe)),s,e]),ct(l,f?f.dsv:"1.0")},ug=function(n,t,i,r,u,f){var e,o;return kh(i)?null:(e=de(n,t,i,r,u,f),e||(o=dh(i,u),e=rg(n,t,o,i,f)),e)},fg=function(n,t,i,r){var u=is(i,ht,r.propertyPath),l=u&&vi(u,"null",d),o,s="1.0",f,e,h,c;if(l&&l.value==="true")return s;if(u&&(o=b(u)||"",!r.keepInContent))for(s="2.0",f=u.parentNode,e=f,f.removeChild(u);e!==i&&ig(e);)f=e.parentNode,f.removeChild(e),e=f;return(h=bp(n,t,r.nsURI,r.nsPrefix,r.entryPath),h.nodeType===2)?(h.value=o,s):(c=r.contentKind,ou(h,[c&&fi(n,null,"type",c),c==="xhtml"?pp(n,o):o]),s)},ge=function(n,t,i){var e=t.__metadata||{},b=e.properties||{},y=e.etag,p=e.uri,s=e.type,o=ki(s,i),h=pl(n,"properties"),l=kt(n,"entry",[kt(n,"author",kt(n,"name")),y&&ke(n,"etag",y),p&&kt(n,"id",p),s&&kt(n,"category",[gi(n,"term",s),gi(n,"scheme",ol)]),kt(n,"content",[gi(n,"type","application/xml"),h])]),f="1.0",r,v,w;for(r in t)if(r!=="__metadata"){var k=b[r]||{},d=o&&(wi(o.property,r)||wi(o.navigationProperty,r)),a=ug(n,r,t[r],k,d,i);a&&(v=a.element,w=u(v)===bt?l:h,c(w,v),f=st(f,a.dsv))}return ra(o,i,function(t){var i=fg(n,l,h,t);f=st(f,i)}),ct(l,f)},ya=function(n,t,i){var f=e(t)?t:t.results,r,o,u,h,s;if(!f)return null;for(r="1.0",o=kt(n,"feed"),u=0,h=f.length;u<h;u++)s=ge(n,f[u],i),c(o,s.element),r=st(r,s.dsv);return ct(o,r)},eg=function(n,t){var u,i,r,f;return n&&(u=ar(n)&&ya||cf(n)&&ge,u&&(i=us(),r=u(i,n,t),r))?(f=r.element,ou(f,[fs(i,d,we),fs(i,ht,sl)]),ct(c(i,f),r.dsv)):null},og=function(n,t,i){if(t){var u=eu(t),r=w(u);if(r)return fa(r,null,i.metadata)}},sg=function(n,t,i){var u=i.contentType=i.contentType||di(ta),r;if(u&&u.mediaType===ta&&(r=eg(t,i.metadata),r))return i.dataServiceVersion=st(i.dataServiceVersion||"1.0",r.dsv),yf(r.element)};r.atomHandler=oi(og,sg,na.join(","),ei);var i=function(n,t,i,r){return{attributes:n,elements:t,text:i||!1,ns:r}},g={elements:{Annotations:i(["Target","Qualifier"],["TypeAnnotation*","ValueAnnotation*"]),Association:i(["Name"],["End*","ReferentialConstraint","TypeAnnotation*","ValueAnnotation*"]),AssociationSet:i(["Name","Association"],["End*","TypeAnnotation*","ValueAnnotation*"]),Binary:i(null,null,!0),Bool:i(null,null,!0),Collection:i(null,["String*","Int*","Float*","Decimal*","Bool*","DateTime*","DateTimeOffset*","Guid*","Binary*","Time*","Collection*","Record*"]),CollectionType:i(["ElementType","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","SRID"]["TypeRef"]),ComplexType:i(["Name","BaseType","Abstract"],["Property*","TypeAnnotation*","ValueAnnotation*"]),DateTime:i(null,null,!0),DateTimeOffset:i(null,null,!0),Decimal:i(null,null,!0),DefiningExpression:i(null,null,!0),Dependent:i(["Role"],["PropertyRef*"]),Documentation:i(null,null,!0),End:i(["Type","Role","Multiplicity","EntitySet"],["OnDelete"]),EntityContainer:i(["Name","Extends"],["EntitySet*","AssociationSet*","FunctionImport*","TypeAnnotation*","ValueAnnotation*"]),EntitySet:i(["Name","EntityType"],["TypeAnnotation*","ValueAnnotation*"]),EntityType:i(["Name","BaseType","Abstract","OpenType"],["Key","Property*","NavigationProperty*","TypeAnnotation*","ValueAnnotation*"]),EnumType:i(["Name","UnderlyingType","IsFlags"],["Member*"]),Float:i(null,null,!0),Function:i(["Name","ReturnType"],["Parameter*","DefiningExpression","ReturnType","TypeAnnotation*","ValueAnnotation*"]),FunctionImport:i(["Name","ReturnType","EntitySet","IsSideEffecting","IsComposable","IsBindable","EntitySetPath"],["Parameter*","ReturnType","TypeAnnotation*","ValueAnnotation*"]),Guid:i(null,null,!0),Int:i(null,null,!0),Key:i(null,["PropertyRef*"]),LabeledElement:i(["Name"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),Member:i(["Name","Value"]),NavigationProperty:i(["Name","Relationship","ToRole","FromRole","ContainsTarget"],["TypeAnnotation*","ValueAnnotation*"]),Null:i(null,null),OnDelete:i(["Action"]),Path:i(null,null,!0),Parameter:i(["Name","Type","Mode","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","ConcurrencyMode","SRID"],["CollectionType","ReferenceType","RowType","TypeRef","TypeAnnotation*","ValueAnnotation*"]),Principal:i(["Role"],["PropertyRef*"]),Property:i(["Name","Type","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","ConcurrencyMode","CollectionKind","SRID"],["CollectionType","ReferenceType","RowType","TypeAnnotation*","ValueAnnotation*"]),PropertyRef:i(["Name"]),PropertyValue:i(["Property","Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),ReferenceType:i(["Type"]),ReferentialConstraint:i(null,["Principal","Dependent"]),ReturnType:i(["ReturnType","Type","EntitySet"],["CollectionType","ReferenceType","RowType"]),RowType:i(["Property*"]),String:i(null,null,!0),Schema:i(["Namespace","Alias"],["Using*","EntityContainer*","EntityType*","Association*","ComplexType*","Function*","ValueTerm*","Annotations*"]),Time:i(null,null,!0),TypeAnnotation:i(["Term","Qualifier"],["PropertyValue*"]),TypeRef:i(["Type","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","SRID"]),Using:i(["Namespace","Alias"]),ValueAnnotation:i(["Term","Qualifier","Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),ValueTerm:i(["Name","Type"],["TypeAnnotation*","ValueAnnotation*"]),Edmx:i(["Version"],["DataServices","Reference*","AnnotationsReference*"],!1,du),DataServices:i(null,["Schema*"],!1,du)}},pa=["m:FC_ContentKind","m:FC_KeepInContent","m:FC_NsPrefix","m:FC_NsUri","m:FC_SourcePath","m:FC_TargetPath"];g.elements.Property.attributes=g.elements.Property.attributes.concat(pa),g.elements.EntityType.attributes=g.elements.EntityType.attributes.concat(pa),g.elements.Edmx={attributes:["Version"],elements:["DataServices"],ns:du},g.elements.DataServices={elements:["Schema*"],ns:du},g.elements.EntityContainer.attributes.push("m:IsDefaultEntityContainer"),g.elements.Property.attributes.push("m:MimeType"),g.elements.FunctionImport.attributes.push("m:HttpMethod"),g.elements.FunctionImport.attributes.push("m:IsAlwaysBindable"),g.elements.EntityType.attributes.push("m:HasStream"),g.elements.DataServices.attributes=["m:DataServiceVersion","m:MaxDataServiceVersion"];var wa=function(n){if(!n)return n;if(n.length>1){var t=n.substr(0,2);return t===t.toUpperCase()?n:n.charAt(0).toLowerCase()+n.substr(1)}return n.charAt(0).toLowerCase()},hg=function(n,t){var r,u,e,i,f,o;if(t==="Documentation")return{isArray:!0,propertyName:"documentation"};if(r=n.elements,!r)return null;for(u=0,e=r.length;u<e;u++)if(i=r[u],f=!1,i.charAt(i.length-1)==="*"&&(f=!0,i=i.substr(0,i.length-1)),t===i)return o=wa(i),{isArray:f,propertyName:o};return null},cg=/^(m:FC_.*)_[0-9]+$/,ba=function(n){return n===ik||n===rk||n===uk||n===fk||n===ek||n===ok},no=function(n){var o=f(n),e=u(n),i=g.elements[o];if(!i)return null;if(i.ns){if(e!==i.ns)return null}else if(!ba(e))return null;var t={},r=[],s=i.attributes||[];return ai(n,function(n){var c=f(n),e=u(n),l=n.value,i,o,h;e!==or&&(i=null,o=!1,ba(e)||e===null?i="":e===d&&(i="m:"),i!==null&&(i+=c,h=cg.exec(i),h&&(i=h[1]),ur(s,i)&&(o=!0,t[wa(c)]=l)),o||r.push(wt(n)))}),y(n,function(n){var o=f(n),u=hg(i,o),e;u?u.isArray?(e=t[u.propertyName],e||(e=[],t[u.propertyName]=e),e.push(no(n))):t[u.propertyName]=no(n):r.push(yr(n))}),i.text&&(t.text=b(n)),r.length&&(t.extensions=r),t},lg=function(n,i){var r=eu(i),u=w(r);return no(u)||t};r.metadataHandler=oi(lg,null,ku,ei);var ka="o",to="f",da="p",ga="c",nv="s",tv="l",ag="odata",dt=ag+".",vg="@"+dt+"bind",io=dt+"metadata",iv=dt+"navigationLinkUrl",nr=dt+"type",nf={readLink:"self",editLink:"edit",nextLink:"__next",mediaReadLink:"media_src",mediaEditLink:"edit_media",mediaContentType:"content_type",mediaETag:"media_etag",count:"__count",media_src:"mediaReadLink",edit_media:"mediaEditLink",content_type:"mediaContentType",media_etag:"mediaETag",url:"uri"},yg=function(n){if(n.indexOf(".")>0){var t=n.indexOf("@"),r=t>-1?n.substring(0,t):null,i=n.substring(t+1);return{target:r,name:i,isOData:i.indexOf(dt)===0}}return null},ro=function(n,t,i,r,u){return k(t)&&t[nr]||i&&i[n+"@"+nr]||r&&r.type||sw(r,u)||null},rv=function(n,t){return t?wi(t.property,n)||wi(t.navigationProperty,n):null},uv=function(n){return k(n)&&n.hasOwnProperty(dt+"id")},pg=function(n,t,i){if(!!t[n+"@"+iv]||i&&i.relationship)return!0;var r=e(t[n])?t[n][0]:t[n];return uv(r)},uo=function(n){return re(n)||te(n)||ie(n)},gt=function(n,t,i,r,u){var f,e;for(f in n)if(f.indexOf(".")>0&&f.charAt(0)!=="#"&&(e=yg(f),e)){var c=e.name,o=e.target,s=null,h=null;o&&(s=rv(o,r),h=ro(o,n[o],n,s,u)),e.isOData?wg(c,o,h,n[f],n,t,i):t[f]=n[f]}return t};5;var wg=function(n,t,i,r,u,f,e){var o=n.substring(dt.length);switch(o){case"navigationLinkUrl":gg(o,t,i,r,u,f,e);return;case"nextLink":case"count":kg(o,t,r,f,e);return;case"mediaReadLink":case"mediaEditLink":case"mediaContentType":case"mediaETag":dg(o,t,i,r,f,e);return;default:bg(o,t,r,f,e);return}},bg=function(n,t,i,r,u){var f=r.__metadata=r.__metadata||{},e=nf[n]||n,s,o;if(n==="editLink"){f.uri=h(i,u),f[e]=f.uri;return}if((n==="readLink"||n==="associationLinkUrl")&&(i=h(i,u)),t){if(s=f.properties=f.properties||{},o=s[t]=s[t]||{},n==="type"){o[e]=o[e]||i;return}o[e]=i;return}f[e]=i},kg=function(n,t,i,r,u){var f=nf[n],e=t?r[t]:r;e[f]=n==="nextLink"?h(i,u):i},dg=function(n,t,i,r,u,f){var e=u.__metadata=u.__metadata||{},c=nf[n],o,s;if((n==="mediaReadLink"||n==="mediaEditLink")&&(r=h(r,f)),t){o=e.properties=e.properties||{},s=o[t]=o[t]||{},s.type=s.type||i,u.__metadata=e,u[t]=u[t]||{__mediaresource:{}},u[t].__mediaresource[c]=r;return}e[c]=r},gg=function(n,t,i,r,u,f,e){var s=f.__metadata=f.__metadata||{},c=s.properties=s.properties||{},o=c[t]=c[t]||{},l=h(r,e);if(u.hasOwnProperty(t)){o.navigationLinkUrl=l;return}f[t]={__deferred:{uri:l}},o.type=o.type||i},fo=function(n,t,i,r,u,f,o){if(typeof n=="string")return nn(n,t,o);if(!uo(t)){if(e(n))return fv(n,t,i,r,f,o);if(k(n))return tn(n,t,i,r,f,o)}return n},nn=function(n,t,i){switch(t){case lu:return se(n);case hu:return pu(n,!1);case cu:return oe(n,!1)}return i?pu(n,!0)||oe(n,!0)||n:n},fv=function(n,t,i,r,u,f){for(var a=au(t),o=[],h=[],e=0,c=n.length;e<c;e++){var s=ro(null,n[e])||a,l={type:s},v=fo(n[e],s,l,r,null,u,f);uo(s)||yu(n[e])||o.push(l),h.push(v)}return o.length>0&&(i.elements=o),{__metadata:{type:t},results:h}},tn=function(n,t,i,r,u,f){var e=tf(n,t,r,u,f),o=e.__metadata,s=o.properties;return s&&(i.properties=s,delete o.properties),e},rn=function(n,t,i,r,u){return e(n)?ov(n,t,i,r,u):k(n)?tf(n,t,i,r,u):null},tf=function(n,t,i,r,u){var e=n[nr]||t,v=ki(e,r)||bi(e,r),o={type:e},s={__metadata:o},h={},f;for(f in n)if(f.indexOf("#")===0)ev(f.substring(1),n[f],s,i,r);else if(f.indexOf(".")===-1){o.properties||(o.properties=h);var c=n[f],l=rv(f,v),y=pg(f,n,l),a=ro(f,c,n,l,r),p=h[f]=h[f]||{type:a};s[f]=y?rn(c,a,i,r,u):fo(c,a,p,i,l,r,u)}return gt(n,s,i,v,r)},ev=function(n,t,i,r,u){var f,s,g,nt;if(n&&(e(t)||k(t))){var l=!1,c=n.lastIndexOf("."),a=n.substring(c+1),v=c>-1?n.substring(0,c):"",y=a===n||v.indexOf(".")===-1?gh(u):nc(v,u);y&&(f=ow(y.functionImport,a),f&&!!f.isSideEffecting&&(l=!ee(f.isSideEffecting)));for(var p=i.__metadata,w=l?"functions":"actions",tt=h(n,r),b=e(t)?t:[t],o=0,d=b.length;o<d;o++)s=b[o],s&&(g=p[w]=p[w]||[],nt={metadata:tt,title:s.title,target:h(s.target,r)},g.push(nt))}},ov=function(n,t,i,r,u){for(var h=e(n)?n:n.value,c=[],f,s,o=0,l=h.length;o<l;o++)c.push(tf(h[o],t,i,r,u));if(f={results:c},k(n)){for(s in n)s.indexOf("#")===0&&(f.__metadata=f.__metadata||{},ev(s.substring(1),n[s],f,i,r));f=gt(n,f,i)}return f},un=function(n,t,i,r){var u={type:t},f=fo(n.value,t,u,i,null,null,r);return gt(n,{__metadata:u,value:f},i)},fn=function(n,t,i,r,u){var f={},e=fv(n.value,t,f,i,r,u);return tt(e.__metadata,f),gt(n,e,i)},en=function(n,t){var r=n.value,u,i,f,o;if(!e(r))return sv(n,t);for(u=[],i=0,f=r.length;i<f;i++)u.push(sv(r[i],t));return o={results:u},gt(n,o,t)},sv=function(n,t){var i={uri:h(n.url,t)},u,r;return i=gt(n,i,t),u=i.__metadata||{},r=u.properties||{},rf(r.url),iu(r,"url","uri"),i},rf=function(n){n&&delete n.type},on=function(n,t){var o=n.value,s=[],c=gt(n,{collections:s},t),e=c.__metadata||{},i=e.properties||{},u,l,f,r;for(rf(i.value),iu(i,"value","collections"),u=0,l=o.length;u<l;u++)f=o[u],r={title:f.name,href:h(f.url,t)},r=gt(f,r,t),e=r.__metadata||{},i=e.properties||{},rf(i.name),rf(i.url),iu(i,"name","title"),iu(i,"url","href"),s.push(r);return{workspaces:[c]}},ni=function(n,t){return{kind:n,type:t||null}},sn=function(n,t,i){var u=n[io],o,c,f,l,h,r,a,s,v,y;if(!u||typeof u!="string")return null;if(o=u.lastIndexOf("#"),o===-1)return ni(nv);if(c=u.indexOf("@Element",o),f=c-1,f<0&&(f=u.indexOf("?",o),f===-1&&(f=u.length)),l=u.substring(o+1,f),l.indexOf("/$links/")>0)return ni(tv);if(h=l.split("/"),h.length>=0){if(r=h[0],a=h[1],uo(r))return ni(da,r);if(vu(r))return ni(ga,r);if(s=a,!a){var p=r.lastIndexOf("."),w=r.substring(p+1),b=w===r?gh(t):nc(r.substring(0,p),t);b&&(v=ew(b.entitySet,w),s=!v?null:v.entityType)}return c>0?ni(ka,s):s?ni(to,s):e(n.value)&&!bi(r,t)&&(y=n.value[0],!yu(y)&&(uv(y)||!i))?ni(to,null):ni(ka,r)}return null},hn=function(n,t,i,r){if(!k(n))return n;var u=n[io],e=sn(n,t,r),f=null;if(e){delete n[io],f=e.type;switch(e.kind){case to:return ov(n,f,u,t,i);case ga:return fn(n,f,u,t,i);case da:return un(n,f,u,i);case nv:return on(n,u);case tv:return en(n,u)}}return tf(n,f,u,t,i)},hv=["type","etag","media_src","edit_media","content_type","media_etag"],cv=function(n,t){var u=/\/\$links\//,i={},r=n.__metadata,f=t&&u.test(t.request.requestUri);return eo(n,r&&r.properties,i,f),i},cn=function(n,t){var i,u,r,f;if(n)for(i=0,u=hv.length;i<u;i++)r=hv[i],f=dt+(nf[r]||r),kr(f,null,n[r],t)},eo=function(n,t,i,r){var u,f;for(u in n)f=n[u],u==="__metadata"?cn(f,i):u.indexOf(".")===-1?r&&u==="uri"?an(f,i):ln(u,f,t,i,r):i[u]=f},ln=function(n,i,r,u){var e=r&&r[n]||{properties:t,type:t},f=es(i,e);if(yu(i)||!i){kr(nr,n,f,u),u[n]=i;return}if(ar(i,f)||bh(i)){pn(n,i,u);return}if(!f&&wh(i)){vn(n,i,u);return}if(ph(i,f)){au(f)&&kr(nr,n,f,u),yn(n,i,u);return}u[n]={},kr(nr,null,f,u[n]),eo(i,e.properties,u[n])},an=function(n,t){t.url=n},vn=function(n,t,i){kr(iv,n,t.__deferred.uri,i)},yn=function(n,t,i){i[n]=[];var r=e(t)?t:t.results;eo(r,null,i[n])},pn=function(n,t,i){if(ar(t)){i[n]=[];for(var u=e(t)?t:t.results,r=0,f=u.length;r<f;r++)lv(n,u[r],!0,i);return}lv(n,t,!1,i)},lv=function(n,t,i,r){var f=t.__metadata&&t.__metadata.uri,u;if(f){wn(n,f,i,r);return}if(u=cv(t),i){r[n].push(u);return}r[n]=u},wn=function(n,t,i,r){var u=n+vg;if(i){r[u]=r[u]||[],r[u].push(t);return}r[u]=t},kr=function(n,i,r,u){r!==t&&(i?u[i+"@"+n]=r:u[n]=r)},av="application/json",vv=di(av),yv=function(n){var i=[],t,r;for(name in n)for(t=0,r=n[name].length;t<r;t++)i.push(tt({metadata:name},n[name][t]));return i},bn=function(n,t,i,r){var h,u,c,e,o,v,a;if(n&&typeof n=="object")if(u=n.__metadata,u&&(u.actions&&(u.actions=yv(u.actions)),u.functions&&(u.functions=yv(u.functions)),h=u&&u.type),c=ki(h,t)||bi(h,t),c){if(e=c.property,e)for(o=0,v=e.length;o<v;o++){var s=e[o],l=s.name,f=n[l];if(s.type==="Edm.DateTime"||s.type==="Edm.DateTimeOffset"){if(f){if(f=i(f),!f)throw{message:"Invalid date/time value"};n[l]=f}}else s.type==="Edm.Time"&&(n[l]=se(f))}}else if(r)for(a in n)f=n[a],typeof f=="string"&&(n[a]=i(f)||f);return n},pv=function(n){if(n){var t=n.properties.odata;return t==="nometadata"||t==="minimalmetadata"||t==="fullmetadata"}return!1},kn=function(n,t){for(var u={collections:[]},r,e,i=0,f=n.EntitySets.length;i<f;i++)r=n.EntitySets[i],e={title:r,href:h(r,t)},u.collections.push(e);return{workspaces:[u]}},dn=/^\/Date\((-?\d+)(\+|-)?(\d+)?\)\/$/,gn=function(n){var t,i;return n<0?(t="-",n=-n):t="+",i=Math.floor(n/60),n=n-60*i,t+l(i,2)+":"+l(n,2)},ntt=function(n){var i=n&&dn.exec(n),t,r,u;if(i&&(t=new Date(s(i[1])),i[2]&&(r=s(i[3]),i[2]==="-"&&(r=-r),u=t.getUTCMinutes(),t.setUTCMinutes(u-r),t.__edmType="Edm.DateTimeOffset",t.__offset=gn(r)),!isNaN(t.valueOf())))return t},ttt=function(t,i,r){var f=nt(r.recognizeDates,t.recognizeDates),h=nt(r.inferJsonLightFeedAsObject,t.inferJsonLightFeedAsObject),e=r.metadata,o=r.dataServiceVersion,s=ntt,u=typeof i=="string"?n.JSON.parse(i):i;if(st("3.0",o)===o){if(pv(r.contentType))return hn(u,e,f,h);s=pu}return u=aw(u.d,function(n,t){return bn(t,e,s,f)}),u=ftt(u,r.dataServiceVersion),utt(u,r.response.requestUri)},wv=function(i){var r=t,u=Date.prototype.toJSON;try{Date.prototype.toJSON=function(){return ah(this)},r=n.JSON.stringify(i,rtt)}finally{Date.prototype.toJSON=u}return r},itt=function(n,i,r){var e=r.dataServiceVersion||"1.0",o=nt(r.useJsonLight,n.useJsonLight),u=r.contentType=r.contentType||vv,f;return u&&u.mediaType===vv.mediaType?(f=i,o||pv(u))?(r.dataServiceVersion=st(e,"3.0"),f=cv(i,r),wv(f)):(st("3.0",e)===e&&(u.properties.odata="verbose",r.contentType=u),wv(f)):t},rtt=function(n,t){return t&&t.__edmType==="Edm.Time"?vh(t):t},utt=function(n,t){var i=k(n)&&!n.__metadata&&e(n.EntitySets);return i?kn(n,t):n},ftt=function(n,t){return t&&t.lastIndexOf(";")===t.length-1&&(t=t.substr(0,t.length-1)),t&&t!=="1.0"||e(n)&&(n={results:n}),n},uf=oi(ttt,itt,av,ei);uf.recognizeDates=!1,uf.useJsonLight=!1,uf.inferJsonLightFeedAsObject=!1,r.jsonHandler=uf;var dr="multipart/mixed",ett=/^HTTP\/1\.\d (\d{3}) (.*)$/i,ott=/^([^()<>@,;:\\"\/[\]?={} \t]+)\s?:\s?(.*)/,oo=function(){return Math.floor((1+Math.random())*65536).toString(16).substr(1)},bv=function(n){return n+oo()+"-"+oo()+"-"+oo()},kv=function(n){return n.handler.partHandler},dv=function(n){var t=n.boundaries;return t[t.length-1]},stt=function(n,t,i){var r=i.contentType.properties.boundary;return{__batchResponses:gv(t,{boundaries:[r],handlerContext:i})}},htt=function(n,t,i){var r=i.contentType=i.contentType||di(dr);if(r.mediaType===dr)return ctt(t,i)},gv=function(n,t){var f="--"+dv(t),u,o,s,r,e,i;for(ff(n,t,f),tr(n,t),u=[];o!=="--"&&t.position<n.length;){if(s=ny(n,t),r=di(s["Content-Type"]),r&&r.mediaType===dr){t.boundaries.push(r.properties.boundary);try{e=gv(n,t)}catch(h){h.response=ty(n,t,f),e=[h]}u.push({__changeResponses:e}),t.boundaries.pop(),ff(n,t,"--"+dv(t))}else{if(!r||r.mediaType!=="application/http")throw{message:"invalid MIME part type "};tr(n,t),i=ty(n,t,f);try{i.statusCode>=200&&i.statusCode<=299?kv(t.handlerContext).read(i,t.handlerContext):i={message:"HTTP request failed",response:i}}catch(h){i=h}u.push(i)}o=n.substr(t.position,2),tr(n,t)}return u},ny=function(n,t){var r={},i,u,f;do f=t.position,u=tr(n,t),i=ott.exec(u),i!==null?r[i[1]]=i[2]:t.position=f;while(u&&i);return fe(r),r},ty=function(n,t,i){var o=t.position,r=ett.exec(tr(n,t)),u,f,e;return r?(u=r[1],f=r[2],e=ny(n,t),tr(n,t)):t.position=o,{statusCode:u,statusText:f,headers:e,body:ff(n,t,"\r\n"+i)}},tr=function(n,t){return ff(n,t,"\r\n")},ff=function(n,t,i){var u=t.position||0,r=n.length;if(i){if(r=n.indexOf(i,u),r===-1)return null;t.position=r+i.length}else t.position=r;return n.substring(u,r)},ctt=function(n,t){var o;if(!rw(n))throw{message:"Data is not a batch object."};for(var r=bv("batch_"),f=n.__batchRequests,u="",i=0,e=f.length;i<e;i++)u+=ef(r,!1)+iy(f[i],t);return u+=ef(r,!0),o=t.contentType.properties,o.boundary=r,u},ef=function(n,t){var i="\r\n--"+n;return t&&(i+="--"),i+"\r\n"},iy=function(n,t,i){var s=n.__changeRequests,r,f,o,h,u;if(e(s)){if(i)throw{message:"Not Supported: change set nested in other change set"};for(f=bv("changeset_"),r="Content-Type: "+dr+"; boundary="+f+"\r\n",o=0,h=s.length;o<h;o++)r+=ef(f,!1)+iy(s[o],t,!0);r+=ef(f,!0)}else r="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\n\r\n",u=tt({},t),u.handler=oi,u.request=n,u.contentType=null,fc(n,kv(t),u),r+=ltt(n);return r},ltt=function(n){var t=(n.method?n.method:"GET")+" "+n.requestUri+" HTTP/1.1\r\n",i;for(i in n.headers)n.headers[i]&&(t=t+i+": "+n.headers[i]+"\r\n");return t+="\r\n",n.body&&(t+=n.body),t};r.batchHandler=oi(stt,htt,dr,ei),so=[r.jsonHandler,r.atomHandler,r.xmlHandler,r.textHandler],ho=function(n,t,i){for(var r=0,u=so.length;r<u&&!so[r][n](t,i);r++);if(r===u)throw{message:"no handler for data"};},r.defaultSuccess=function(t){n.alert(n.JSON.stringify(t))},r.defaultError=ru,r.defaultHandler={read:function(n,t){n&&at(n.body)&&n.headers["Content-Type"]&&ho("read",n,t)},write:function(n,t){ho("write",n,t)},maxDataServiceVersion:ei,accept:"application/atomsvc+xml;q=0.8, application/json;odata=fullmetadata;q=0.7, application/json;q=0.5, */*;q=0.1"},r.defaultMetadata=[],r.read=function(n,t,i,u,f,e){var o;return o=n instanceof String||typeof n=="string"?{requestUri:n}:n,r.request(o,t,i,u,f,e)},r.request=function(n,t,i,u,f,e){t=t||r.defaultSuccess,i=i||r.defaultError,u=u||r.defaultHandler,f=f||r.defaultHttpClient,e=e||r.defaultMetadata,n.recognizeDates=nt(n.recognizeDates,r.jsonHandler.recognizeDates),n.callbackParameterName=nt(n.callbackParameterName,r.defaultHttpClient.callbackParameterName),n.formatQueryString=nt(n.formatQueryString,r.defaultHttpClient.formatQueryString),n.enableJsonpCallback=nt(n.enableJsonpCallback,r.defaultHttpClient.enableJsonpCallback),n.useJsonLight=nt(n.useJsonLight,r.jsonHandler.enableJsonpCallback),n.inferJsonLightFeedAsObject=nt(n.inferJsonLightFeedAsObject,r.jsonHandler.inferJsonLightFeedAsObject);var o={metadata:e,recognizeDates:n.recognizeDates,callbackParameterName:n.callbackParameterName,formatQueryString:n.formatQueryString,enableJsonpCallback:n.enableJsonpCallback,useJsonLight:n.useJsonLight,inferJsonLightFeedAsObject:n.inferJsonLightFeedAsObject};try{return fc(n,u,o),iw(n,t,i,u,f,o)}catch(s){i(s)}},r.batchHandler.partHandler=r.defaultHandler;var ut=null,att=function(){var t={v:this.valueOf(),t:"[object Date]"},n;for(n in this)t[n]=this[n];return t},vtt=function(n,t){var r,i;if(t&&t.t==="[object Date]"){r=new Date(t.v);for(i in t)i!=="t"&&i!=="v"&&(r[i]=t[i]);t=r}return t},of=function(n,t){return n.name+"#!#"+t},ry=function(n,t){return t.replace(n.name+"#!#","")},v=function(n){this.name=n};v.create=function(t){if(v.isSupported())return ut=ut||n.localStorage,new v(t);throw{message:"Web Storage not supported by the browser"};},v.isSupported=function(){return!!n.localStorage},v.prototype.add=function(n,t,i,r){r=r||this.defaultError;var u=this;this.contains(n,function(f){f?o(r,{message:"key already exists",key:n}):u.addOrUpdate(n,t,i,r)},r)},v.prototype.addOrUpdate=function(i,r,u,f){var s,h,e;if(f=f||this.defaultError,i instanceof Array)f({message:"Array of keys not supported"});else{s=of(this,i),h=Date.prototype.toJSON;try{e=r,e!==t&&(Date.prototype.toJSON=att,e=n.JSON.stringify(r)),ut.setItem(s,e),o(u,i,r)}catch(c){c.code===22||c.number===2147942414?o(f,{name:"QUOTA_EXCEEDED_ERR",error:c}):o(f,c)}finally{Date.prototype.toJSON=h}}},v.prototype.clear=function(n,t){var i,r,u,f;t=t||this.defaultError;try{for(i=0,r=ut.length;r>0&&i<r;)u=ut.key(i),f=ry(this,u),u!==f?(ut.removeItem(u),r=ut.length):i++;o(n)}catch(e){o(t,e)}},v.prototype.close=function(){},v.prototype.contains=function(n,t,i){i=i||this.defaultError;try{var r=of(this,n),u=ut.getItem(r);o(t,u!==null)}catch(f){o(i,f)}},v.prototype.defaultError=ru,v.prototype.getAllKeys=function(n,t){var r,i,e,u,f;t=t||this.defaultError,r=[];try{for(i=0,e=ut.length;i<e;i++)u=ut.key(i),f=ry(this,u),u!==f&&r.push(f);o(n,r)}catch(s){o(t,s)}},v.prototype.mechanism="dom",v.prototype.read=function(i,r,u){if(u=u||this.defaultError,i instanceof Array)u({message:"Array of keys not supported"});else try{var e=of(this,i),f=ut.getItem(e);f=f!==null&&f!=="undefined"?n.JSON.parse(f,vtt):t,o(r,i,f)}catch(s){o(u,s)}},v.prototype.remove=function(n,t,i){if(i=i||this.defaultError,n instanceof Array)i({message:"Batches not supported"});else try{var r=of(this,n);ut.removeItem(r),o(t)}catch(u){o(i,u)}},v.prototype.update=function(n,t,i,r){r=r||this.defaultError;var u=this;this.contains(n,function(f){f?u.addOrUpdate(n,t,i,r):o(r,{message:"key not found",key:n})},r)};var uy=n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.indexedDB,ytt=n.IDBKeyRange||n.webkitIDBKeyRange,fy=n.IDBTransaction||n.webkitIDBTransaction||{},ey=fy.READ_ONLY||"readonly",ir=fy.READ_WRITE||"readwrite",lt=function(n,t){return function(i){var r=n||t,u,f;if(r){if(Object.prototype.toString.call(i)==="[object IDBDatabaseException]"){if(i.code===11){r({name:"QuotaExceededError",error:i});return}r(i);return}try{f=i.target.error||i,u=f.name}catch(e){u=i.type==="blocked"?"IndexedDBBlocked":"UnknownError"}r({name:u,error:i})}}},ptt=function(n,t,i){var u=n.name,f="_datajs_"+u,r=uy.open(f);r.onblocked=i,r.onerror=i,r.onupgradeneeded=function(){var n=r.result;n.objectStoreNames.contains(u)||n.createObjectStore(u)},r.onsuccess=function(n){var f=r.result,e;if(!f.objectStoreNames.contains(u)){if("setVersion"in f){e=f.setVersion("1.0"),e.onsuccess=function(){var n=e.transaction;n.oncomplete=function(){t(f)},f.createObjectStore(u,null,!1)},e.onerror=i,e.onblocked=i;return}n.target.error={name:"DBSchemaMismatch"},i(n);return}f.onversionchange=function(n){n.target.close()},t(f)}},ti=function(n,t,i,r){var u=n.name,f=n.db,e=lt(r,n.defaultError);if(f){i(f.transaction(u,t));return}ptt(n,function(r){n.db=r,i(r.transaction(u,t))},e)},p=function(n){this.name=n};p.create=function(n){if(p.isSupported())return new p(n);throw{message:"IndexedDB is not supported on this browser"};},p.isSupported=function(){return!!uy},p.prototype.add=function(n,t,i,r){var e=this.name,o=this.defaultError,u=[],f=[];n instanceof Array?(u=n,f=t):(u=[n],f=[t]),ti(this,ir,function(s){s.onabort=lt(r,o,n,"add"),s.oncomplete=function(){n instanceof Array?i(u,f):i(n,t)};for(var h=0;h<u.length&&h<f.length;h++)s.objectStore(e).add({v:f[h]},u[h])},r)},p.prototype.addOrUpdate=function(n,t,i,r){var e=this.name,o=this.defaultError,u=[],f=[];n instanceof Array?(u=n,f=t):(u=[n],f=[t]),ti(this,ir,function(s){var h,c;for(s.onabort=lt(r,o),s.oncomplete=function(){n instanceof Array?i(u,f):i(n,t)},h=0;h<u.length&&h<f.length;h++)c={v:f[h]},s.objectStore(e).put(c,u[h])},r)},p.prototype.clear=function(n,t){var i=this.name,r=this.defaultError;ti(this,ir,function(u){u.onerror=lt(t,r),u.oncomplete=function(){n()},u.objectStore(i).clear()},t)},p.prototype.close=function(){this.db&&(this.db.close(),this.db=null)},p.prototype.contains=function(n,t,i){var r=this.name,u=this.defaultError;ti(this,ey,function(f){var e=f.objectStore(r),o=e.get(n);f.oncomplete=function(){t(!!o.result)},f.onerror=lt(i,u)},i)},p.prototype.defaultError=ru,p.prototype.getAllKeys=function(n,t){var i=this.name,r=this.defaultError;ti(this,ir,function(u){var e=[],f;u.oncomplete=function(){n(e)},f=u.objectStore(i).openCursor(),f.onerror=lt(t,r),f.onsuccess=function(n){var t=n.target.result;t&&(e.push(t.key),t["continue"].call(t))}},t)},p.prototype.mechanism="indexeddb",p.prototype.read=function(n,i,r){var f=this.name,e=this.defaultError,u=n instanceof Array?n:[n];ti(this,ey,function(o){var h=[],s,c,l;for(o.onerror=lt(r,e,n,"read"),o.oncomplete=function(){n instanceof Array?i(u,h):i(u[0],h[0])},s=0;s<u.length;s++)c=o.objectStore(f),l=c.get.call(c,u[s]),l.onsuccess=function(n){var i=n.target.result;h.push(i?i.v:t)}},r)},p.prototype.remove=function(n,t,i){var u=this.name,f=this.defaultError,r=n instanceof Array?n:[n];ti(this,ir,function(n){var e,o;for(n.onerror=lt(i,f),n.oncomplete=function(){t()},e=0;e<r.length;e++)o=n.objectStore(u),o["delete"].call(o,r[e])},i)},p.prototype.update=function(n,t,i,r){var e=this.name,o=this.defaultError,u=[],f=[];n instanceof Array?(u=n,f=t):(u=[n],f=[t]),ti(this,ir,function(s){var h,c,l;for(s.onabort=lt(r,o),s.oncomplete=function(){n instanceof Array?i(u,f):i(n,t)},h=0;h<u.length&&h<f.length;h++)c=s.objectStore(e).openCursor(ytt.only(u[h])),l={v:f[h]},c.pair={key:u[h],value:l},c.onsuccess=function(n){var t=n.target.result;t?t.update(n.target.pair.value):s.abort()}},r)},ii=function(n){var e=[],r=[],i={},u,f;this.name=n,u=function(n){return n||this.defaultError},f=function(n,i){var r;return(n instanceof Array&&(r="Array of keys not supported"),(n===t||n===null)&&(r="Invalid key"),r)?(o(i,{message:r}),!1):!0},this.add=function(n,t,r,e){e=u(e),f(n,e)&&(i.hasOwnProperty(n)?e({message:"key already exists",key:n}):this.addOrUpdate(n,t,r,e))},this.addOrUpdate=function(n,s,h,c){if(c=u(c),f(n,c)){var l=i[n];l===t&&(l=e.length>0?e.splice(0,1):r.length),r[l]=s,i[n]=l,o(h,n,s)}},this.clear=function(n){r=[],i={},e=[],o(n)},this.contains=function(n,t){var r=i.hasOwnProperty(n);o(t,r)},this.getAllKeys=function(n){var t=[],r;for(r in i)t.push(r);o(n,t)},this.read=function(n,t,e){if(e=u(e),f(n,e)){var s=i[n];o(t,n,r[s])}},this.remove=function(n,s,h){if(h=u(h),f(n,h)){var c=i[n];c!==t&&(c===r.length-1?r.pop():(r[c]=t,e.push(c)),delete i[n],r.length===0&&(e=[])),o(s)}},this.update=function(n,t,r,e){e=u(e),f(n,e)&&(i.hasOwnProperty(n)?this.addOrUpdate(n,t,r,e):e({message:"key not found",key:n}))}},ii.create=function(n){return new ii(n)},ii.isSupported=function(){return!0},ii.prototype.close=function(){},ii.prototype.defaultError=ru,ii.prototype.mechanism="memory",oy={indexeddb:p,dom:v,memory:ii},ui.defaultStoreMechanism="best",ui.createStore=function(n,t){t||(t=ui.defaultStoreMechanism),t==="best"&&(t=v.isSupported()?"dom":"memory");var i=oy[t];if(i)return i.create(n);throw{message:"Failed to create store",name:n,mechanism:t};};var wtt=function(n,t){var i=n.indexOf("?")>=0?"&":"?";return n+i+t},btt=function(n,t){var i=n.indexOf("?"),r="";return i>=0&&(r=n.substr(i),n=n.substr(0,i)),n[n.length-1]!=="/"&&(n+="/"),n+t+r},sy=function(n,t){return{method:"GET",requestUri:n,user:t.user,password:t.password,enableJsonpCallback:t.enableJsonpCallback,callbackParameterName:t.callbackParameterName,formatQueryString:t.formatQueryString}},uit=function(n,t){var u=-1,r=n.indexOf("?"),i;return r!==-1&&(i=n.indexOf("?"+t+"=",r),i===-1&&(i=n.indexOf("&"+t+"=",r)),i!==-1&&(u=i+t.length+2)),u},ktt=function(n,t,i,r){return hy(n,t,[],i,r)},hy=function(n,i,u,f,e){var s=sy(n,i),o=r.request(s,function(n){var t=n.__next,r=n.results;u=u.concat(r),t?o=hy(t,i,u,f,e):f(u)},e,t,i.httpClient,i.metadata);return{abort:function(){o.abort()}}},dtt=function(n){var i=this,u=n.source;return i.identifier=ip(encodeURI(decodeURI(u))),i.options=n,i.count=function(n,f){var e=i.options;return r.request(sy(btt(u,"$count"),e),function(t){var i=s(t.toString());isNaN(i)?f({message:"Count is NaN",count:i}):n(i)},f,t,e.httpClient,e.metadata)},i.read=function(n,t,r,f){var e="$skip="+n+"&$top="+t;return ktt(wtt(u,e),i.options,r,f)},i},gtt=function(n,t){var r=nit(n,t),i,u;r&&(i=r.i-t.i,u=i+(n.c-n.d.length),n.d=n.d.concat(t.d.slice(i,u)))},nit=function(n,t){var r=n.i+n.c,u=t.i+t.c,i=n.i>t.i?n.i:t.i,f=r<u?r:u,e;return f>=i&&(e={i:i,c:f-i}),e},cy=function(n,i){if(n===t||typeof n!="number")throw{message:"'"+i+"' must be a number."};if(isNaN(n)||n<0||!isFinite(n))throw{message:"'"+i+"' must be greater than or equal to zero."};},tit=function(n,i){if(n!==t){if(typeof n!="number")throw{message:"'"+i+"' must be a number."};if(isNaN(n)||n<=0||!isFinite(n))throw{message:"'"+i+"' must be greater than zero."};}},ly=function(n,i){if(n!==t&&(typeof n!="number"||isNaN(n)||!isFinite(n)))throw{message:"'"+i+"' must be a number."};},co=function(n,t){for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return n.splice(i,1),!0;return!1},ay=function(n){var t=0,r=typeof n,i;if(r==="object"&&n)for(i in n)t+=i.length*2+ay(n[i]);else t=r==="string"?n.length*2:8;return t},vy=function(n,t,i){return n=Math.floor(n/i)*i,t=Math.ceil((t+1)/i)*i,{i:n,c:t-n}},sf="destroy",hi="idle",yy="init",lo="read",ao="prefetch",vo="write",gr="cancel",ri="end",yo="error",ci="start",py="wait",wy="clear",nu="done",tu="local",by="save",ky="source",rr=function(n,t,i,r,u,f,e){var h,c,o=this,l,s;return o.p=t,o.i=r,o.c=u,o.d=f,o.s=ci,o.canceled=!1,o.pending=e,o.oncomplete=null,o.cancel=function(){if(i){var n=o.s;n!==yo&&n!==ri&&n!==gr&&(o.canceled=!0,s(gr,h))}},o.complete=function(){s(ri,h)},o.error=function(n){o.canceled||s(yo,n)},o.run=function(n){c=n,o.transition(o.s,h)},o.wait=function(n){s(py,n)},l=function(t,i,r){switch(t){case ci:i!==yy&&n(o,t,i,r);break;case py:n(o,t,i,r);break;case gr:n(o,t,i,r),o.fireCanceled(),s(ri);break;case yo:n(o,t,i,r),o.canceled=!0,o.fireRejected(r),s(ri);break;case ri:if(o.oncomplete)o.oncomplete(o);o.canceled||o.fireResolved(),n(o,t,i,r);break;default:n(o,t,i,r)}},s=function(n,t){o.s=n,h=t,l(n,c,t)},o.transition=s,o};rr.prototype.fireResolved=function(){var n=this.p;n&&(this.p=null,n.resolve(this.d))},rr.prototype.fireRejected=function(n){var t=this.p;t&&(this.p=null,t.reject(n))},rr.prototype.fireCanceled=function(){this.fireRejected({canceled:!0,message:"Operation canceled"})},dy=function(i){var it=yy,y={counts:0,netReads:0,prefetches:0,cacheReads:0},c=[],b=[],p=[],g=0,l=!1,k=lf(i.cacheSize,1048576),a=0,h=0,d=0,nt=k===0,r=lf(i.pageSize,50),ut=lf(i.prefetchSize,r),st="1.0",f,ft=0,w=i.source,v,u;typeof w=="string"&&(w=new dtt(i)),w.options=i,v=ui.createStore(i.name,i.mechanism),u=this,u.onidle=i.idle,u.stats=y,u.count=function(){var n,i,t;if(f)throw f;return(n=su(),i=!1,l)?(o(function(){n.resolve(a)}),n.promise()):(t=w.count(function(i){t=null,y.counts++,n.resolve(i)},function(r){t=null,n.reject(tt(r,{canceled:i}))}),tt(n.promise(),{cancel:function(){t&&(i=!0,t.abort(),t=null)}}))},u.clear=function(){if(f)throw f;if(c.length===0){var n=su(),t=new rr(ti,n,!1);return et(t,c),n.promise()}return c[0].p},u.filterForward=function(n,t,i){return ct(n,t,i,!1)},u.filterBack=function(n,t,i){return ct(n,t,i,!0)},u.readRange=function(n,t){if(cy(n,"index"),cy(t,"count"),f)throw f;var i=su(),r=new rr(fi,i,!0,n,t,[],0);return et(r,b),tt(i.promise(),{cancel:function(){r.cancel()}})},u.ToObservable=u.toObservable=function(){if(!n.Rx||!n.Rx.Observable)throw{message:"Rx library not available - include rx.js"};if(f)throw f;return n.Rx.Observable.CreateWithDisposable(function(n){var t=!1,i=0,f=function(i){t||n.OnError(i)},e=function(o){if(!t){for(var s=0,h=o.length;s<h;s++)n.OnNext(o[s]);o.length<r?n.OnCompleted():(i+=r,u.readRange(i,r).then(e,f))}};return u.readRange(i,r).then(e,f),{Dispose:function(){t=!0}}})};var rt=function(n){return function(t){f={message:n,error:t};for(var i=0,r=b.length;i<r;i++)b[i].fireRejected(f);for(i=0,r=c.length;i<r;i++)c[i].fireRejected(f);b=c=null}},e=function(n){if(n!==it){it=n;for(var i=c.concat(b,p),t=0,r=i.length;t<r;t++)i[t].run(it)}},ht=function(){var n=new pi;return v.clear(function(){g=0,l=!1,a=0,h=0,d=0,nt=k===0,y={counts:0,netReads:0,prefetches:0,cacheReads:0},u.stats=y,v.close(),n.resolve()},function(t){n.reject(t)}),n},bt=function(n){var t=co(c,n);t||(t=co(b,n),t||co(p,n)),ft--,e(hi)},kt=function(n){var t=new pi,u=!1,i=w.read(n,r,function(i){var r={i:n,c:i.length,d:i};t.resolve(r)},function(n){t.reject(n)});return tt(t,{cancel:function(){i&&(i.abort(),u=!0,i=null)}})},ct=function(n,t,i,e){if(n=s(n),t=s(t),isNaN(n))throw{message:"'index' must be a valid number.",index:n};if(isNaN(t))throw{message:"'count' must be a valid number.",count:t};if(f)throw f;n=Math.max(n,0);var h=su(),o=[],a=!1,l=null,v=function(n,f){a||(t>=0&&o.length>=t?h.resolve(o):l=u.readRange(n,f).then(function(u){for(var l,a,y,p,s=0,c=u.length;s<c&&(t<0||o.length<t);s++)l=e?c-s-1:s,a=u[l],i(a)&&(y={index:n+l,item:a},e?o.unshift(y):o.push(y));!e&&u.length<f||e&&n<=0?h.resolve(o):(p=e?Math.max(n-r,0):n+f,v(p,r))},function(n){h.reject(n)}))},c=vy(n,n,r),y=e?c.i:n,p=e?n-c.i+1:c.i+c.c-n;return v(y,p),tt(h.promise(),{cancel:function(){l&&l.cancel(),a=!0}})},lt=function(){u.onidle&&ft===0&&u.onidle()},dt=function(n){if(!l&&ut!==0&&!nt&&(p.length===0||p[0]&&p[0].c!==-1)){var t=new rr(ii,null,!0,n,ut,null,ut);et(t,p)}},et=function(n,t){n.oncomplete=bt,t.push(n),ft++,n.run(it)},gt=function(n){var r=!1,i=tt(new pi,{cancel:function(){r=!0}}),u=vt(i,"Read page from store failure");return v.contains(n,function(f){if(!r){if(f){v.read(n,function(n,u){r||i.resolve(u!==t,u)},u);return}i.resolve(!1)}},u),i},ni=function(n,t){var e=!1,i=tt(new pi,{cancel:function(){e=!0}}),r=vt(i,"Save page to store failure"),u=function(){i.resolve(!0)},f;return t.c>0?(f=ay(t),nt=k>=0&&k<g+f,nt?u():v.addOrUpdate(n,t,function(){yt(t,f),ot(u,r)},r)):(yt(t,0),ot(u,r)),i},ot=function(n,t){var i={actualCacheSize:g,allDataLocal:l,cacheSize:k,collectionCount:a,highestSavedPage:h,highestSavedPageSize:d,pageSize:r,sourceId:w.identifier,version:st};v.addOrUpdate("__settings",i,n,t)},vt=function(n){return function(){n.resolve(!1)}},yt=function(n,t){var i=n.c,u=n.i;i===0?h===u-r&&(a=h+d):(h=Math.max(h,u),h===u&&(d=i),g+=t,i<r&&!a&&(a=u+i)),l||a!==h+d||(l=!0)},pt=function(n,t,i,r){var u=n.canceled&&t!==ri;return u&&t===gr&&r&&r.cancel&&r.cancel(),u},ti=function(n,t,i){var r=n.transition;if(i!==sf)return e(sf),!0;switch(t){case ci:r(wy);break;case ri:lt();break;case wy:ht().then(function(){n.complete()}),n.wait();break;default:return!1}return!0},ii=function(n,t,i,u){var o,f;if(!pt(n,t,i,u)){if(o=n.transition,i!==ao)return i===sf?t!==gr&&n.cancel():i===hi&&e(ao),!0;switch(t){case ci:p[0]===n&&o(tu,n.i);break;case nu:f=n.pending,f>0&&(f-=Math.min(f,u.c)),l||f===0||u.c<r||nt?n.complete():(n.pending=f,o(tu,u.i+r));break;default:return wt(n,t,i,u,!0)}}return!0},fi=function(n,t,i,u){var f,o,s;if(!pt(n,t,i,u)){if(f=n.transition,i!==lo&&t!==ci)return i===sf?t!==ci&&n.cancel():i!==vo&&e(lo),!0;switch(t){case ci:(i===hi||i===ao)&&(e(lo),n.c>0?(o=vy(n.i,n.c,r),f(tu,o.i)):f(nu,n));break;case nu:gtt(n,u),s=n.d.length,n.c===s||u.c<r?(y.cacheReads++,dt(u.i+u.c),n.complete()):f(tu,u.i+r);break;default:return wt(n,t,i,u,!1)}}return!0},wt=function(n,t,i,r,u){var s=n.error,o=n.transition,h=n.wait,f;switch(t){case ri:lt();break;case tu:f=gt(r).then(function(t,i){n.canceled||(t?o(nu,i):o(ky,r))});break;case ky:f=kt(r).then(function(t){n.canceled||(u?y.prefetches++:y.netReads++,o(by,t))},s);break;case by:i!==vo&&(e(vo),f=ni(r.i,r).then(function(t){n.canceled||(!t&&u&&(n.pending=0),o(nu,r)),e(hi)}));break;default:return!1}return f&&(n.canceled?f.cancel():n.s===t&&h(f)),!0};return v.read("__settings",function(n,t){if(at(t)){var i=t.version;if(!i||i.indexOf("1.")!==0){rt("Unsupported cache store version "+i)();return}r!==t.pageSize||w.identifier!==t.sourceId?ht().then(function(){e(hi)},rt("Unable to clear store during initialization")):(g=t.actualCacheSize,l=t.allDataLocal,k=t.cacheSize,a=t.collectionCount,h=t.highestSavedPage,d=t.highestSavedPageSize,st=i,e(hi))}else ot(function(){e(hi)},rt("Unable to write settings during initialization."))},rt("Unable to read settings from store.")),u},ui.createDataCache=function(n){if(tit(n.pageSize,"pageSize"),ly(n.cacheSize,"cacheSize"),ly(n.prefetchSize,"prefetchSize"),!at(n.name))throw{message:"Undefined or null name",options:n};if(!at(n.source))throw{message:"Undefined source",options:n};return new dy(n)}})(this)